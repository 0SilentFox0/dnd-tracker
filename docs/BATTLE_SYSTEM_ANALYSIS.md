# D&D Battle System - –ê–Ω–∞–ª—ñ–∑ –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏ —Ç–∞ –ü–ª–∞–Ω –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∏

## üìä –ü–û–¢–û–ß–ù–ò–ô –°–¢–ê–ù –°–ò–°–¢–ï–ú–ò

### 1. –Ø–∫ –∑–∞—Ä–∞–∑ –ø—Ä–∞—Ü—é—î —Å–∏—Å—Ç–µ–º–∞

#### 1.1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö

**Character (–ü–µ—Ä—Å–æ–Ω–∞–∂):**
- –ó–±–µ—Ä—ñ–≥–∞—î –ø–æ–≤–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é: —Å—Ç–∞—Ç–∏, HP, –∑–∞–∫–ª–∏–Ω–∞–Ω–Ω—è, `skillTreeProgress` (JSON)
- `immunities` —è–∫ JSON –º–∞—Å–∏–≤ —Ä—è–¥–∫—ñ–≤
- `spellSlots` —è–∫ JSON –æ–±'—î–∫—Ç `{ "1": { max, current }, ... }`
- `knownSpells` —è–∫ JSON –º–∞—Å–∏–≤ ID –∑–∞–∫–ª–∏–Ω–∞–Ω—å
- `skillTreeProgress` —è–∫ JSON –∑ –ø—Ä–æ–≥—Ä–µ—Å–∞–º–∏ –ø–æ –¥–µ—Ä–µ–≤–∞–º —Å–∫—ñ–ª—ñ–≤

**Unit (–Æ–Ω—ñ—Ç):**
- –ê–Ω–∞–ª–æ–≥—ñ—á–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –∞–ª–µ –ø—Ä–æ—Å—Ç—ñ—à–∞
- `attacks` —è–∫ JSON –º–∞—Å–∏–≤
- `specialAbilities` —è–∫ JSON –º–∞—Å–∏–≤
- `knownSpells` —è–∫ JSON –º–∞—Å–∏–≤ ID (—â–æ–π–Ω–æ –¥–æ–¥–∞–Ω–æ)

**Skill (–°–∫—ñ–ª):**
- –ó–≤'—è–∑–∞–Ω–∏–π –∑ `spellId`, `spellGroupId`, `mainSkillId`
- –ú–∞—î `spellEnhancementTypes` (JSON –º–∞—Å–∏–≤): `["effect_increase", "target_change", "additional_modifier", "new_spell"]`
- `spellEffectIncrease`: —á–∏—Å–ª–æ (–≤—ñ–¥—Å–æ—Ç–æ–∫)
- `spellTargetChange`: JSON –æ–±'—î–∫—Ç `{ target: "enemies" | "allies" | "all" }`
- `spellAdditionalModifier`: JSON –æ–±'—î–∫—Ç `{ modifier?: string, damageDice?: string, duration?: number }`
- `spellNewSpellId`: ID –Ω–æ–≤–æ–≥–æ –∑–∞–∫–ª–∏–Ω–∞–Ω–Ω—è

**Spell (–ó–∞–∫–ª–∏–Ω–∞–Ω–Ω—è):**
- `level` (0-5), `type`, `target`, `damageType`, `damageElement`
- `damageModifier`: "burning", "poison", "freezing", "control", "charm", "sleep", "state"
- `healModifier`: "heal", "regeneration", "dispel", "shield", "vampirism"
- `diceCount`, `diceType` –¥–ª—è —É—Ä–æ–Ω—É/–ª—ñ–∫—É–≤–∞–Ω–Ω—è
- `savingThrow` —è–∫ JSON –æ–±'—î–∫—Ç

**Race (–†–∞—Å–∞):**
- `passiveAbility` —è–∫ JSON (–º–æ–∂–µ –±—É—Ç–∏ string –∞–±–æ object –∑ `description`, `statModifiers`)
- `availableSkills`, `disabledSkills` —è–∫ JSON –º–∞—Å–∏–≤–∏
- `spellSlotProgression` —è–∫ JSON –º–∞—Å–∏–≤ `[{ level, slots }]`

**BattleScene (–ë–∞–∑–æ–≤–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —î):**
- `participants` —è–∫ JSON –º–∞—Å–∏–≤
- `initiativeOrder` —è–∫ JSON –º–∞—Å–∏–≤ (–º—ñ—Å—Ç–∏—Ç—å `InitiativeParticipant`)
- `battleLog` —è–∫ JSON –º–∞—Å–∏–≤ –ø—Ä–æ—Å—Ç–∏—Ö –∑–∞–ø–∏—Å—ñ–≤
- –ë–∞–∑–æ–≤–∞ –ª–æ–≥—ñ–∫–∞ –∞—Ç–∞–∫–∏ –≤–∂–µ —ñ—Å–Ω—É—î (`/attack/route.ts`)

#### 1.2. –ú–µ—Ö–∞–Ω—ñ–∫–∏ —è–∫—ñ –≤–∂–µ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ

‚úÖ **–†–æ–∑—Ä–∞—Ö—É–Ω–∫–∏:**
- `getAbilityModifier()` - –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –∑ ability score
- `getProficiencyBonus()` - –±–æ–Ω—É—Å –º–∞–π—Å—Ç–µ—Ä–Ω–æ—Å—Ç—ñ
- `getSpellSaveDC()`, `getSpellAttackBonus()` - –¥–ª—è –∑–∞–∫–ª–∏–Ω–∞–Ω—å
- `rollDamage()` - —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —É—Ä–æ–Ω—É –∑ –∫—É–±–∏–∫—ñ–≤
- `getAttackDamageModifier()` - –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä —É—Ä–æ–Ω—É –ø–æ —Ç–∏–ø—É –∞—Ç–∞–∫–∏
- `getArtifactDamageBonus()`, `getArtifactAttackBonus()` - –±–æ–Ω—É—Å–∏ –∑ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ñ–≤
- `getSkillTreeBonus()` - –±–æ–Ω—É—Å–∏ –∑ –¥–µ—Ä–µ–≤–∞ —Å–∫—ñ–ª—ñ–≤

‚úÖ **–Ü–º—É–Ω—ñ—Ç–µ—Ç–∏ —Ç–∞ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏:**
- `getCharacterImmunities()`, `getUnitImmunities()` - –æ–±'—î–¥–Ω—É—é—Ç—å —ñ–º—É–Ω—ñ—Ç–µ—Ç–∏ –∑ —Ä–∞—Å–∏ —Ç–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
- `getCharacterDamageModifiers()`, `getUnitDamageModifiers()` - –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ —É—Ä–æ–Ω—É
- –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏: `COMMON_IMMUNITIES`, `IMMUNITY_PATTERNS`, `DAMAGE_MODIFIER_OPTIONS`

‚úÖ **–ó–∞–∫–ª–∏–Ω–∞–Ω–Ω—è:**
- `getSpellLevelsForSkillLevel()` - —è–∫—ñ —Ä—ñ–≤–Ω—ñ –∑–∞–∫–ª–∏–Ω–∞–Ω—å –¥–æ—Å—Ç—É–ø–Ω—ñ –∑–∞ —Ä—ñ–≤–Ω–µ–º —Å–∫—ñ–ª—É
- `getSpellsToAddForSkill()` - —è–∫—ñ –∑–∞–∫–ª–∏–Ω–∞–Ω–Ω—è –¥–æ–¥–∞—é—Ç—å—Å—è –ø—Ä–∏ –ø—Ä–æ–∫–∞—á—Ü—ñ —Å–∫—ñ–ª—É
- `calculateSpellsToAdd()` - –∑–∞–≥–∞–ª—å–Ω–∏–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –∑–∞–∫–ª–∏–Ω–∞–Ω—å –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞

‚úÖ **–ë–∞–∑–æ–≤–∏–π –±—ñ–π:**
- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è BattleScene (status: "prepared")
- –ó–∞–ø—É—Å–∫ –±–æ—é (status: "active", —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ initiative)
- –ü—Ä–æ—Å—Ç–∞ –∞—Ç–∞–∫–∞ –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º AC, —É—Ä–æ–Ω—É, –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ñ–≤
- Next turn –ª–æ–≥—ñ–∫–∞

#### 1.3. –©–æ –≤—ñ–¥—Å—É—Ç–Ω—î –∞–±–æ –ø–æ—Ç—Ä–µ–±—É—î –¥–æ–æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è

‚ùå **BattleParticipant - –ø–æ–≤–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- –ó–∞—Ä–∞–∑ `InitiativeParticipant` –º—ñ—Å—Ç–∏—Ç—å –ª–∏—à–µ –±–∞–∑–æ–≤—ñ –ø–æ–ª—è
- –ü–æ—Ç—Ä—ñ–±–Ω–∞ –ø–æ–≤–Ω–∞ –∫–æ–ø—ñ—è Character/Unit –∑ —É—Å—ñ–º–∞ –¥–∞–Ω–∏–º–∏ –¥–ª—è –±–æ—é
- –ê–∫—Ç–∏–≤–Ω—ñ –µ—Ñ–µ–∫—Ç–∏, –ø–∞—Å–∏–≤–Ω—ñ –∑–¥—ñ–±–Ω–æ—Å—Ç—ñ, –µ–∫—ñ–ø—ñ—Ä–æ–≤–∞–Ω—ñ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∏ - –Ω–µ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è

‚ùå **–ê–∫—Ç–∏–≤–Ω—ñ –µ—Ñ–µ–∫—Ç–∏ (activeEffects):**
- –ù–µ–º–∞—î —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–ª—è DOT/HOT –µ—Ñ–µ–∫—Ç—ñ–≤
- –ù–µ–º–∞—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –Ω–∞ –ø–æ—á–∞—Ç–∫—É —Ö–æ–¥—É
- –ù–µ–º–∞—î –∑–º–µ–Ω—à–µ–Ω–Ω—è —Ç—Ä–∏–≤–∞–ª–æ—Å—Ç—ñ

‚ùå **–ü–∞—Å–∏–≤–Ω—ñ –∑–¥—ñ–±–Ω–æ—Å—Ç—ñ –∑ —Ç—Ä–∏–≥–µ—Ä–∞–º–∏:**
- –ù–µ–º–∞—î —Å–∏—Å—Ç–µ–º–∏ —Ç—Ä–∏–≥–µ—Ä—ñ–≤ (`on_hit`, `ally_low_hp`, —Ç–æ—â–æ)
- –ù–µ–º–∞—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—ó –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ç–∞ —Å–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è
- –ù–µ–º–∞—î —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–ª—è `trigger` + `effect`

‚ùå **–ú–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ —É—Ä–æ–Ω—É –∑—ñ —Å–∫—ñ–ª—ñ–≤:**
- –ó–∞—Ä–∞–∑ —î —Ç—ñ–ª—å–∫–∏ `getSkillTreeBonus()` –¥–ª—è –ø—Ä–æ—Å—Ç–∏—Ö –±–æ–Ω—É—Å—ñ–≤
- –ù–µ–º–∞—î –æ–±—Ä–æ–±–∫–∏ –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–∏—Ö –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä—ñ–≤ (`melee_damage_percent`)
- –ù–µ–º–∞—î —Å—Ç–∞–∫—É–≤–∞–Ω–Ω—è –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–∏—Ö –±–æ–Ω—É—Å—ñ–≤

‚ùå **–ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è –∑–∞–∫–ª–∏–Ω–∞–Ω–Ω—è (spellEnhancements):**
- –ü–æ–ª—è —î –≤ Skill, –∞–ª–µ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –≤ –±–æ—é
- `spellEffectIncrease` - –Ω–µ –∑–∞—Å—Ç–æ—Å–æ–≤—É—î—Ç—å—Å—è
- `spellTargetChange` - –Ω–µ –æ–±—Ä–æ–±–ª—è—î—Ç—å—Å—è
- `spellAdditionalModifier` - –Ω–µ –¥–æ–¥–∞—î—Ç—å—Å—è –¥–æ —É—Ä–æ–Ω—É

‚ùå **–ú–æ—Ä–∞–ª—å:**
- –ù–µ–º–∞—î –ø–æ–ª—è `morale` –≤ Character/Unit
- –ù–µ–º–∞—î –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –º–æ—Ä–∞–ª—ñ –Ω–∞ –ø–æ—á–∞—Ç–∫—É —Ö–æ–¥—É
- –ù–µ–º–∞—î –ª–æ–≥—ñ–∫–∏ –¥–æ–¥–∞—Ç–∫–æ–≤–æ–≥–æ —Ö–æ–¥—É / –ø—Ä–æ–ø—É—Å–∫—É —Ö–æ–¥—É

‚ùå **–ö—Ä–∏—Ç–∏—á–Ω—ñ –µ—Ñ–µ–∫—Ç–∏:**
- –ù–µ–º–∞—î –±–∞–∑–∏ CriticalEffect –≤ –ë–î
- –ù–µ–º–∞—î –≤–∏–ø–∞–¥–∫–æ–≤–æ–≥–æ –≤–∏–±–æ—Ä—É –µ—Ñ–µ–∫—Ç—É –ø—Ä–∏ 1/20

‚ùå **–ö–æ–Ω—Ç—Ä-—É–¥–∞—Ä (Reaction):**
- –ù–µ–º–∞—î –ª–æ–≥—ñ–∫–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∫–æ–Ω—Ç—Ä-—É–¥–∞—Ä—É
- –ù–µ–º–∞—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ä–µ–∞–∫—Ü—ñ—ó

‚ùå **–ü—Ä–∏–∑–∏–≤–∞–Ω–Ω—è (Summons):**
- –ù–µ–º–∞—î `pendingSummons` –≤ BattleScene
- –ù–µ–º–∞—î –ª–æ–≥—ñ–∫–∏ –ø—Ä–∏–∑–∏–≤–∞–Ω–Ω—è —Ç–∞ –ø–æ—è–≤–∏ –≤ –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É —Ä–∞—É–Ω–¥—ñ
- –ù–µ–º–∞—î –æ–±–º–µ–∂–µ–Ω–Ω—è –Ω–∞ 3 –ø—Ä–∏–∑–≤–∞–Ω–∏—Ö

‚ùå **–î–µ—Ç–∞–ª—å–Ω–∏–π BattleAction:**
- –ó–∞—Ä–∞–∑ `battleLog` –º—ñ—Å—Ç–∏—Ç—å –ª–∏—à–µ –ø—Ä–æ—Å—Ç—ñ –∑–∞–ø–∏—Å–∏
- –ù–µ–º–∞—î –ø–æ–≤–Ω–æ—ó —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ BattleAction –∑ —É—Å—ñ–º–∞ –¥–µ—Ç–∞–ª—è–º–∏
- –ù–µ–º–∞—î –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ rollback

‚ùå **–Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±–æ—é:**
- –ó–∞—Ä–∞–∑ —î –±–∞–∑–æ–≤–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ `/battles/[battleId]`
- –ü–æ—Ç—Ä—ñ–±–µ–Ω –ø–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–∏–π UI –∑ –∫–∞—Ä—Ç–∫–∞–º–∏ —É—á–∞—Å–Ω–∏–∫—ñ–≤, –ø–∞–Ω–µ–ª–ª—é –¥—ñ–π, –ª–æ–≥–æ–º

‚ùå **WebSocket —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è:**
- –ó–∞—Ä–∞–∑ —î –±–∞–∑–æ–≤–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ Pusher
- –ü–æ—Ç—Ä—ñ–±–Ω–∞ –ø–æ–≤–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –≤—Å—ñ—Ö –¥—ñ–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ

---

## üìã TODO: –í–°–Ü –ü–£–ù–ö–¢–ò –ü–Ü–î–ì–û–¢–û–í–ö–ò –ë–û–Æ

### –§–ê–ó–ê 1: –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è –°—Ç—Ä—É–∫—Ç—É—Ä–∏ –î–∞–Ω–∏—Ö

#### 1.1. BattleParticipant - –ü–æ–≤–Ω–∞ –°—Ç—Ä—É–∫—Ç—É—Ä–∞
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ –ø–æ–≤–Ω—É –º–æ–¥–µ–ª—å `BattleParticipant` –≤ TypeScript
- [ ] –î–æ–¥–∞—Ç–∏ –ø–æ–ª—è: `activeEffects`, `passiveAbilities`, `racialAbilities`, `activeSkills`, `equippedArtifacts`
- [ ] –î–æ–¥–∞—Ç–∏ —Ñ–ª–∞–≥–∏: `hasUsedAction`, `hasUsedBonusAction`, `hasUsedReaction`, `hasExtraTurn`
- [ ] –†–æ–∑—à–∏—Ä–∏—Ç–∏ `initiativeOrder` –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –ø–æ–≤–Ω–∏—Ö BattleParticipant (–∑–∞—Ä–∞–∑ —Ç—ñ–ª—å–∫–∏ –±–∞–∑–æ–≤—ñ –ø–æ–ª—è)

#### 1.2. BattleAction - –î–µ—Ç–∞–ª—å–Ω–∞ –°—Ç—Ä—É–∫—Ç—É—Ä–∞
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å `BattleAction` –∑ —É—Å—ñ–º–∞ –ø–æ–ª—è–º–∏
- [ ] –†–æ–∑—à–∏—Ä–∏—Ç–∏ `battleLog` –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è BattleAction –∑–∞–º—ñ—Å—Ç—å –ø—Ä–æ—Å—Ç–∏—Ö –∑–∞–ø–∏—Å—ñ–≤
- [ ] –î–æ–¥–∞—Ç–∏ –ø–æ–ª—è: `actionDetails`, `hpChanges`, `isCancelled`

#### 1.3. CriticalEffect - –ë–∞–∑–∞ –ö—Ä–∏—Ç–∏—á–Ω–∏—Ö –ï—Ñ–µ–∫—Ç—ñ–≤
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ –º–æ–¥–µ–ª—å `CriticalEffect` –≤ Prisma schema
- [ ] –î–æ–¥–∞—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—é –¥–ª—è —Ç–∞–±–ª–∏—Ü—ñ `critical_effects`
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ API routes –¥–ª—è CRUD –æ–ø–µ—Ä–∞—Ü—ñ–π –∑ –∫—Ä–∏—Ç–∏—á–Ω–∏–º–∏ –µ—Ñ–µ–∫—Ç–∞–º–∏
- [ ] –î–æ–¥–∞—Ç–∏ UI –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫—Ä–∏—Ç–∏—á–Ω–∏–º–∏ –µ—Ñ–µ–∫—Ç–∞–º–∏ (DM)

#### 1.4. –ê–∫—Ç–∏–≤–Ω—ñ –ï—Ñ–µ–∫—Ç–∏ (ActiveEffects)
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å `ActiveEffect` –∑ –ø–æ–ª—è–º–∏: `id`, `name`, `type`, `duration`, `effects[]`, `dotDamage?`
- [ ] –î–æ–¥–∞—Ç–∏ –ª–æ–≥—ñ–∫—É –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è DOT –Ω–∞ –ø–æ—á–∞—Ç–∫—É —Ö–æ–¥—É
- [ ] –î–æ–¥–∞—Ç–∏ –ª–æ–≥—ñ–∫—É –∑–º–µ–Ω—à–µ–Ω–Ω—è —Ç—Ä–∏–≤–∞–ª–æ—Å—Ç—ñ –µ—Ñ–µ–∫—Ç—ñ–≤
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–∏—Ö –µ—Ñ–µ–∫—Ç—ñ–≤ –Ω–∞ –∫–∞—Ä—Ç—Ü—ñ —É—á–∞—Å–Ω–∏–∫–∞

#### 1.5. –ü–∞—Å–∏–≤–Ω—ñ –ó–¥—ñ–±–Ω–æ—Å—Ç—ñ –∑ –¢—Ä–∏–≥–µ—Ä–∞–º–∏
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å `PassiveAbility` –∑ `trigger` —Ç–∞ `effect`
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Å–∏—Å—Ç–µ–º—É —Ç—Ä–∏–≥–µ—Ä—ñ–≤: `on_hit`, `on_attack`, `ally_low_hp`, `start_of_turn`, `end_of_turn`
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ç—Ä–∏–≥–µ—Ä—ñ–≤ –ø–µ—Ä–µ–¥ –∫–æ–∂–Ω–æ—é –¥—ñ—î—é
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –æ–±—Ä–æ–±–∫—É —É–º–æ–≤ (`condition`) –∑ —Ç—Ä–∏–≥–µ—Ä—ñ–≤
- [ ] –î–æ–¥–∞—Ç–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫—É `chance` (–≤—ñ–¥—Å–æ—Ç–æ–∫ —Å–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è)

#### 1.6. –ú–æ—Ä–∞–ª—å (Morale)
- [ ] –î–æ–¥–∞—Ç–∏ –ø–æ–ª–µ `morale` (number, -3 –¥–æ +3) –≤ Character/Unit schema
- [ ] –î–æ–¥–∞—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—é –¥–ª—è `morale` –ø–æ–ª—è
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –º–æ—Ä–∞–ª—ñ –Ω–∞ –ø–æ—á–∞—Ç–∫—É —Ö–æ–¥—É
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —à–∞–Ω—Å—É –¥–æ–¥–∞—Ç–∫–æ–≤–æ–≥–æ —Ö–æ–¥—É / –ø—Ä–æ–ø—É—Å–∫—É —Ö–æ–¥—É
- [ ] –î–æ–¥–∞—Ç–∏ UI –¥–ª—è –≤–≤–µ–¥–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É 1d10

### –§–ê–ó–ê 2: –†–æ–∑—Ä–∞—Ö—É–Ω–∫–∏ —Ç–∞ –ú–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏

#### 2.1. –ú–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ –£—Ä–æ–Ω—É –∑—ñ –°–∫—ñ–ª—ñ–≤
- [ ] –†–æ–∑—à–∏—Ä–∏—Ç–∏ `activeSkills` –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –µ—Ñ–µ–∫—Ç—ñ–≤ —Å–∫—ñ–ª—ñ–≤ –∑ –±–æ—é
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –æ–±—Ä–æ–±–∫—É –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–∏—Ö –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä—ñ–≤ (`melee_damage_percent`, `ranged_damage_percent`)
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Å—Ç–∞–∫—É–≤–∞–Ω–Ω—è –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–∏—Ö –±–æ–Ω—É—Å—ñ–≤ (–∞–¥–∏—Ç–∏–≤–Ω–æ)
- [ ] –î–æ–¥–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é `calculateDamageWithModifiers()` —è–∫–∞ –≤—Ä–∞—Ö–æ–≤—É—î –≤—Å—ñ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏

#### 2.2. –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è –ó–∞–∫–ª–∏–Ω–∞–Ω–Ω—è (Spell Enhancements)
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è `spellEffectIncrease` (+25% —É—Ä–æ–Ω—É)
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ `spellTargetChange` (–∑–º—ñ–Ω–∞ —Ü—ñ–ª—ñ –∑ "all" –Ω–∞ "enemies")
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ `spellAdditionalModifier` (–¥–æ–¥–∞—Ç–∫–æ–≤–∏–π —É—Ä–æ–Ω –∑ –∫—É–±–∏–∫—ñ–≤)
- [ ] –î–æ–¥–∞—Ç–∏ –ª–æ–≥—ñ–∫—É –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –ø–æ–∫—Ä–∞—â–µ–Ω—å –∑–∞–∫–ª–∏–Ω–∞–Ω–Ω—è –ø—Ä–∏ –∫–∞—Å—Ç—ñ

#### 2.3. –ê—Ä—Ç–µ—Ñ–∞–∫—Ç–∏ –≤ –ë–æ—é
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è `equippedArtifacts` –≤ BattleParticipant –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ –±–æ—é
- [ ] –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –±–æ–Ω—É—Å–∏ –∑ `bonuses` (flat –∑–Ω–∞—á–µ–Ω–Ω—è)
- [ ] –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ –∑ `modifiers` (flat –∞–±–æ percentage)
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –ø–∞—Å–∏–≤–Ω—ñ –∑–¥—ñ–±–Ω–æ—Å—Ç—ñ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ñ–≤ (`passiveAbility`)

#### 2.4. –†–∞—Å–æ–≤—ñ –ó–¥—ñ–±–Ω–æ—Å—Ç—ñ —Ç–∞ –Ü–º—É–Ω—ñ—Ç–µ—Ç–∏
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è `racialAbilities` –≤ BattleParticipant
- [ ] –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ —ñ–º—É–Ω—ñ—Ç–µ—Ç–∏ –ø—Ä–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É —É—Ä–æ–Ω—É (fire_immunity ‚Üí —É—Ä–æ–Ω = 0)
- [ ] –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –æ–ø—ñ—Ä (resistance) –ø—Ä–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É —É—Ä–æ–Ω—É (50% –æ–ø—ñ—Ä ‚Üí —É—Ä–æ–Ω √ó 0.5)
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, necromancer morale = 0)

### –§–ê–ó–ê 3: –õ–æ–≥—ñ–∫–∞ –ë–æ—é

#### 3.1. –°—Ç–∞—Ä—Ç –ë–æ—é - –°—Ç–≤–æ—Ä–µ–Ω–Ω—è BattleParticipant
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –ø–æ–≤–Ω–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è Character –≤ BattleParticipant
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –ø–æ–≤–Ω–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è Unit –≤ BattleParticipant (–∑ instanceNumber –¥–ª—è quantity > 1)
- [ ] –†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ –≤—Å—ñ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
- [ ] –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∞–∫—Ç–∏–≤–Ω—ñ —Å–∫—ñ–ª–∏ –∑ `skillTreeProgress`
- [ ] –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –µ–∫—ñ–ø—ñ—Ä–æ–≤–∞–Ω—ñ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∏ –∑ inventory
- [ ] –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –ø–æ—á–∞—Ç–∫–æ–≤—ñ –µ—Ñ–µ–∫—Ç–∏ –∑ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ñ–≤/–ø–∞—Å–∏–≤–æ–∫ (`start_of_battle`)

#### 3.2. –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ Initiative
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ `baseInitiative` –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —É—á–∞—Å–Ω–∏–∫–∞
- [ ] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞ (–§–∞–π–¥–∞–µ–Ω = initiative 999)
- [ ] –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ —Ç–∏–º—á–∞—Å–æ–≤—ñ –±–æ–Ω—É—Å–∏ –¥–æ initiative
- [ ] –í—ñ–¥—Å–æ—Ä—Ç—É–≤–∞—Ç–∏ `initiativeOrder` –∑–∞ initiative, baseInitiative, dexterity

#### 3.3. –ü–æ—á–∞—Ç–æ–∫ –•–æ–¥—É (Start of Turn)
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –≥—Ä–∞–≤—Ü—è
- [ ] –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ DOT –µ—Ñ–µ–∫—Ç–∏ (damagePerRound)
- [ ] –ó–º–µ–Ω—à–∏—Ç–∏ —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –≤—Å—ñ—Ö –µ—Ñ–µ–∫—Ç—ñ–≤
- [ ] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø–∞—Å–∏–≤–∫–∏ –∑ `start_of_turn` —Ç—Ä–∏–≥–µ—Ä–æ–º
- [ ] –°–∫–∏–Ω—É—Ç–∏ —Ñ–ª–∞–≥–∏ –¥—ñ–π (`hasUsedAction`, `hasUsedBonusAction`, `hasUsedReaction`)

#### 3.4. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ú–æ—Ä–∞–ª—ñ
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ UI –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –º–æ—Ä–∞–ª—ñ (–ø–æ–ø–∞–ø –∑ 1d10)
- [ ] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ä–∞—Å–æ–≤—ñ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ –º–æ—Ä–∞–ª—ñ
- [ ] –†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ —à–∞–Ω—Å —Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- [ ] –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ `hasExtraTurn` –∞–±–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–∏ —Ö—ñ–¥

#### 3.5. –ê—Ç–∞–∫–∞ - –†–æ–∑—à–∏—Ä–µ–Ω–∞ –õ–æ–≥—ñ–∫–∞
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –≤–∏–±—ñ—Ä –∑–±—Ä–æ—ó –∑ `attacks`
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –≤–∏–±—ñ—Ä —Ü—ñ–ª—ñ (–æ–¥–Ω–∞ —Ü—ñ–ª—å –∞–±–æ AOE)
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ Attack Roll –∑ —É—Å—ñ–º–∞ –±–æ–Ω—É—Å–∞–º–∏
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ Advantage –¥–ª—è –µ–ª—å—Ñ—ñ–≤ (ranged –∞—Ç–∞–∫–∏)
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∫—Ä–∏—Ç–∏—á–Ω–µ –ø–æ–ø–∞–¥–∞–Ω–Ω—è (20) —Ç–∞ –≤–∏–±—ñ—Ä CriticalEffect
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∫—Ä–∏—Ç–∏—á–Ω–∏–π –ø—Ä–æ–º–∞—Ö (1) —Ç–∞ –≤–∏–±—ñ—Ä CriticalEffect
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ Damage Roll –∑ –∫—É–±–∏–∫–∞–º–∏ –æ–∫—Ä–µ–º–æ
- [ ] –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –≤—Å—ñ –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ñ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ –∑—ñ —Å–∫—ñ–ª—ñ–≤
- [ ] –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –±–æ–Ω—É—Å–∏ –∑ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ñ–≤
- [ ] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø–∞—Å–∏–≤–∫–∏ –∑ —Ç—Ä–∏–≥–µ—Ä–∞–º–∏ (`on_attack`, `ally_low_hp`)
- [ ] –î–æ–¥–∞—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ —É—Ä–æ–Ω—É (–ø—ñ–¥–ø–∞–ª, –æ—Ç—Ä—É—Ç–∞)
- [ ] –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –æ–ø—ñ—Ä/—ñ–º—É–Ω—ñ—Ç–µ—Ç —Ü—ñ–ª—ñ
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∫–æ–Ω—Ç—Ä-—É–¥–∞—Ä (Reaction) —è–∫—â–æ —É–º–æ–≤–∏ –≤–∏–∫–æ–Ω–∞–Ω—ñ

#### 3.6. –ó–∞–∫–ª–∏–Ω–∞–Ω–Ω—è - –†–æ–∑—à–∏—Ä–µ–Ω–∞ –õ–æ–≥—ñ–∫–∞
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ UI –≤–∏–±–æ—Ä—É –∑–∞–∫–ª–∏–Ω–∞–Ω–Ω—è –∑ –ø–æ–∫–∞–∑–æ–º spell slots
- [ ] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–∫–ª–∏–Ω–∞–Ω–Ω—è (spell slots, –æ–±–º–µ–∂–µ–Ω–Ω—è)
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –≤–∏–±—ñ—Ä —Ü—ñ–ª–µ–π (Target vs AOE)
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ Saving Throws –¥–ª—è –∫–æ–∂–Ω–æ—ó —Ü—ñ–ª—ñ
- [ ] –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –∑–∞–∫–ª–∏–Ω–∞–Ω–Ω—è (`spellEffectIncrease`, `spellAdditionalModifier`)
- [ ] –†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ —É—Ä–æ–Ω/–ª—ñ–∫—É–≤–∞–Ω–Ω—è –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –≤—Å—ñ—Ö –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä—ñ–≤
- [ ] –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ DOT/HOT –µ—Ñ–µ–∫—Ç–∏ –∑ –∑–∞–∫–ª–∏–Ω–∞–Ω–Ω—è
- [ ] –ó–º–µ–Ω—à–∏—Ç–∏ spell slot –ø—ñ—Å–ª—è –∫–∞—Å—Ç—É

#### 3.7. –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è –•–æ–¥—É
- [ ] –û–±—Ä–æ–±–∏—Ç–∏ `hasExtraTurn` (–ø–æ–≤—Ç–æ—Ä Start of Turn)
- [ ] –ü–µ—Ä–µ–π—Ç–∏ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —É—á–∞—Å–Ω–∏–∫–∞
- [ ] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ —Ä–∞—É–Ω–¥ –∑–∞–∫—ñ–Ω—á–∏–≤—Å—è ‚Üí Start of Round

#### 3.8. –ü–æ—á–∞—Ç–æ–∫ –†–∞—É–Ω–¥—É
- [ ] –ü–µ—Ä–µ—Å–æ—Ä—Ç—É–≤–∞—Ç–∏ `initiativeOrder` –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –∑–º—ñ–Ω
- [ ] –î–æ–¥–∞—Ç–∏ `pendingSummons` –≤ `initiativeOrder`
- [ ] –û—á–∏—Å—Ç–∏—Ç–∏ `pendingSummons`
- [ ] –ó–∞–ø–∏—Å–∞—Ç–∏ –≤ –ª–æ–≥ "üîÅ –ü–æ—á–∞—Ç–æ–∫ –†–∞—É–Ω–¥—É X"

#### 3.9. –ü—Ä–∏–∑–∏–≤–∞–Ω–Ω—è (Summons)
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –ø—Ä–∏–∑–≤–∞–Ω–∏—Ö (< 3)
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –±–æ–Ω—É—Å –¥—ñ—é –¥–ª—è –ø—Ä–∏–∑–∏–≤—É (–ê–≥—Ä–∞—ó–ª)
- [ ] –î–æ–¥–∞—Ç–∏ –ø—Ä–∏–∑–≤–∞–Ω—É —ñ—Å—Ç–æ—Ç—É –≤ `pendingSummons` –∑ initiative
- [ ] –ü—Ä–∏–∑–≤–∞–Ω—ñ –æ—Ç—Ä–∏–º—É—é—Ç—å 200% —É—Ä–æ–Ω—É

#### 3.10. –ü–µ—Ä–µ–º–æ–≥–∞ —Ç–∞ –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è –ë–æ—é
- [ ] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —É–º–æ–≤–∏ –ø–µ—Ä–µ–º–æ–≥–∏ (–≤—Å—ñ –≤–æ—Ä–æ–≥–∏ unconscious/dead)
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∫–Ω–æ–ø–∫—É "–ó–∞–≤–µ—Ä—à–∏—Ç–∏ –±—ñ–π" –¥–ª—è DM
- [ ] –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ `status = "completed"`, `result = "victory" | "defeat"`
- [ ] –í—ñ–¥–Ω–æ–≤–∏—Ç–∏ HP –≤—Å—ñ—Ö unconscious —Å–æ—é–∑–Ω–∏–∫—ñ–≤ –¥–æ `maxHp`

### –§–ê–ó–ê 4: –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ç–∞ UI

#### 4.1. –°—Ç–æ—Ä—ñ–Ω–∫–∞ –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∏ –ë–æ—é (`/dm/battles/new`)
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ–æ—Ä–º—É –∑ –ø–æ–ª—è–º–∏ –Ω–∞–∑–≤–∏ —Ç–∞ –æ–ø–∏—Å—É
- [ ] –ü–æ–∫–∞–∑–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ Player Characters –∑ —á–µ–∫–±–æ–∫—Å–∞–º–∏
- [ ] –ü–æ–∫–∞–∑–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ NPC Heroes –∑ —á–µ–∫–±–æ–∫—Å–∞–º–∏
- [ ] –ü–æ–∫–∞–∑–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ NPC Units –∑ —á–µ–∫–±–æ–∫—Å–∞–º–∏ —Ç–∞ –ø–æ–ª–µ–º quantity
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –¥–≤–∞ —Å—Ç–æ–≤–ø—Ü—ñ: "–°–æ—é–∑–Ω–∏–∫–∏" —Ç–∞ "–í–æ—Ä–æ–≥–∏"
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ drag & drop –º—ñ–∂ —Å—Ç–æ–≤–ø—Ü—è–º–∏ (–∞–±–æ –∫–Ω–æ–ø–∫–∏)
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∫–Ω–æ–ø–∫—É "–î—É–±–ª—é–≤–∞—Ç–∏" –¥–ª—è —ñ—Å–Ω—É—é—á–∏—Ö —Å—Ü–µ–Ω

#### 4.2. –°—Ç–æ—Ä—ñ–Ω–∫–∞ –ê–∫—Ç–∏–≤–Ω–æ–≥–æ –ë–æ—é (`/battles/[battleId]/play`)
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –≤–µ—Ä—Ö–Ω—é –ø–∞–Ω–µ–ª—å (–Ω–∞–∑–≤–∞, —Ä–∞—É–Ω–¥, –∫–Ω–æ–ø–∫–∞ "–ó–∞–≤–µ—Ä—à–∏—Ç–∏ –•—ñ–¥")
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –¥–≤–∞ —Å—Ç–æ–≤–ø—Ü—ñ —É—á–∞—Å–Ω–∏–∫—ñ–≤ (–°–æ—é–∑–Ω–∏–∫–∏ | –í–æ—Ä–æ–≥–∏)
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `ParticipantCard` –∑ —É—Å—ñ–º–∞ –ø–æ–ª—è–º–∏
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Ä—ñ–∑–Ω—É –≤–∏–¥–∏–º—ñ—Å—Ç—å –¥–ª—è –≥—Ä–∞–≤—Ü—ñ–≤ (–±–µ–∑ HP –≤–æ—Ä–æ–≥—ñ–≤) —Ç–∞ DM (–≤—Å—ñ –¥–∞–Ω—ñ)
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –ø–∞–Ω–µ–ª—å –¥—ñ–π (ActionPanel) –∑ –∫–Ω–æ–ø–∫–∞–º–∏
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∑–≥–æ—Ä—Ç–∞—î—Ç—å—Å—è –ª–æ–≥ –±–æ—é

#### 4.3. –ú–æ–¥–∞–ª—å–Ω—ñ –í—ñ–∫–Ω–∞
- [ ] "üéØ –¢–≤—ñ–π —Ö—ñ–¥!" - –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –≥—Ä–∞–≤—Ü—è
- [ ] "üé≤ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ú–æ—Ä–∞–ª—ñ" - –ø–æ–ø–∞–ø –∑ 1d10
- [ ] "‚öîÔ∏è –û–±–µ—Ä—ñ—Ç—å –ê—Ç–∞–∫—É" - —Å–ø–∏—Å–æ–∫ –∑–±—Ä–æ—ó
- [ ] "üéØ –í–∏–±—ñ—Ä –¶—ñ–ª—ñ" - —Å–ø–∏—Å–æ–∫ —É—á–∞—Å–Ω–∏–∫—ñ–≤ (–æ–¥–Ω–∞ —Ü—ñ–ª—å –∞–±–æ —á–µ–∫–±–æ–∫—Å–∏ –¥–ª—è AOE)
- [ ] "üé≤ Attack Roll" - –ø–æ–ª–µ –¥–ª—è 1d20 + –±–æ–Ω—É—Å–∏
- [ ] "üí• Damage Roll" - –ø–æ–ª—è –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∫—É–±–∏–∫–∞
- [ ] "‚ú® –ö–Ω–∏–≥–∞ –ó–∞–∫–ª–∏–Ω–∞–Ω—å" - —Å–ø–∏—Å–æ–∫ –∑–∞–∫–ª–∏–Ω–∞–Ω—å –∑ spell slots
- [ ] "üé≤ Saving Throw" - –¥–ª—è –∫–æ–∂–Ω–æ—ó —Ü—ñ–ª—ñ –∑–∞–∫–ª–∏–Ω–∞–Ω–Ω—è

#### 4.4. –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ê–∫—Ç–∏–≤–Ω–∏—Ö –ï—Ñ–µ–∫—Ç—ñ–≤
- [ ] –Ü–∫–æ–Ω–∫–∏ –µ—Ñ–µ–∫—Ç—ñ–≤ –Ω–∞ –∫–∞—Ä—Ç—Ü—ñ —É—á–∞—Å–Ω–∏–∫–∞
- [ ] Tooltip –∑ –Ω–∞–∑–≤–æ—é —Ç–∞ —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—é
- [ ] –ü—ñ–¥—Å–≤—ñ—á—É–≤–∞–Ω–Ω—è –ø–æ–∑–∏—Ç–∏–≤–Ω–∏—Ö (–∑–µ–ª–µ–Ω—ñ) / –Ω–µ–≥–∞—Ç–∏–≤–Ω–∏—Ö (—á–µ—Ä–≤–æ–Ω—ñ) –µ—Ñ–µ–∫—Ç—ñ–≤

### –§–ê–ó–ê 5: WebSocket —Ç–∞ –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è

#### 5.1. –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è Real-time –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó
- [ ] –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ Pusher/Ably –¥–ª—è WebSocket
- [ ] –í—ñ–¥–ø—Ä–∞–≤–ª—è—Ç–∏ `battle_started` –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ –±–æ—é
- [ ] –í—ñ–¥–ø—Ä–∞–≤–ª—è—Ç–∏ `battle_updated` –ø—ñ—Å–ª—è –∫–æ–∂–Ω–æ—ó –¥—ñ—ó
- [ ] –í—ñ–¥–ø—Ä–∞–≤–ª—è—Ç–∏ `turn_started` –∫–æ–ª–∏ –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è —Ö—ñ–¥ –≥—Ä–∞–≤—Ü—è
- [ ] –í—ñ–¥–ø—Ä–∞–≤–ª—è—Ç–∏ `notification` –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –≥—Ä–∞–≤—Ü—è
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è UI —á–µ—Ä–µ–∑ WebSocket –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ

#### 5.2. –û–Ω–æ–≤–ª–µ–Ω–Ω—è State —á–µ—Ä–µ–∑ WebSocket
- [ ] –ü—ñ–¥–ø–∏—Å–∞—Ç–∏—Å—å –Ω–∞ –∫–∞–Ω–∞–ª `battle-${battleId}` –≤ React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ
- [ ] –û–Ω–æ–≤–ª—é–≤–∞—Ç–∏ battle state —á–µ—Ä–µ–∑ `useQueryClient.invalidateQueries()`
- [ ] –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏ –≤—Å—ñ—Ö –≥—Ä–∞–≤—Ü—ñ–≤ –ø—Ä–∏ –∫–æ–∂–Ω—ñ–π –∑–º—ñ–Ω—ñ

### –§–ê–ó–ê 6: –Ü—Å—Ç–æ—Ä—ñ—è –ë–æ—é —Ç–∞ Rollback

#### 6.1. –î–µ—Ç–∞–ª—å–Ω–∏–π Battle Log
- [ ] –ó–±–µ—Ä—ñ–≥–∞—Ç–∏ –≤—Å—ñ `BattleAction` –≤ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—Å—Ç—ñ
- [ ] –í—ñ–¥–æ–±—Ä–∞–∂–∞—Ç–∏ –ª–æ–≥ –∑ –¥–µ—Ç–∞–ª—å–Ω–∏–º –æ–ø–∏—Å–æ–º –∫–æ–∂–Ω–æ—ó –¥—ñ—ó
- [ ] –î–æ–¥–∞—Ç–∏ –∫–Ω–æ–ø–∫–∏ "–†–µ–¥–∞–≥—É–≤–∞—Ç–∏" —Ç–∞ "–í–∏–¥–∞–ª–∏—Ç–∏" –¥–ª—è DM

#### 6.2. –í—ñ–¥–º—ñ–Ω–∞ –î—ñ–π (Rollback)
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è BattleAction –∑ –ª–æ–≥—É
- [ ] –í—ñ–¥–∫–æ—Ç–∏—Ç–∏ –≤—Å—ñ –∑–º—ñ–Ω–∏ (HP, –µ—Ñ–µ–∫—Ç–∏, —Å–ª–æ—Ç–∏, summon)
- [ ] –ü–æ–≤–µ—Ä–Ω—É—Ç–∏ `currentTurnIndex` –¥–æ –∞–∫—Ç–æ—Ä–∞
- [ ] WebSocket broadcast –ø—Ä–æ –≤—ñ–¥–º—ñ–Ω—É

### –§–ê–ó–ê 7: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ –í–∞–ª—ñ–¥–∞—Ü—ñ—è

#### 7.1. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –ú–µ—Ö–∞–Ω—ñ–∫
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –≤—Å—ñ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ —É—Ä–æ–Ω—É (—Å–∫—ñ–ª–∏, –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∏, –ø–∞—Å–∏–≤–∫–∏)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –∑–∞–∫–ª–∏–Ω–∞–Ω–Ω—è
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ —ñ–º—É–Ω—ñ—Ç–µ—Ç–∏ —Ç–∞ –æ–ø—ñ—Ä
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –º–æ—Ä–∞–ª—å —Ç–∞ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ —Ö–æ–¥–∏
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –∫—Ä–∏—Ç–∏—á–Ω—ñ –µ—Ñ–µ–∫—Ç–∏ (1/20)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –∫–æ–Ω—Ç—Ä-—É–¥–∞—Ä
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –ø—Ä–∏–∑–∏–≤–∞–Ω–Ω—è

#### 7.2. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ WebSocket –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ (–∫—ñ–ª—å–∫–∞ –≥—Ä–∞–≤—Ü—ñ–≤)
- [ ] –ü–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—å —â–æ –≤—Å—ñ –≥—Ä–∞–≤—Ü—ñ –±–∞—á–∞—Ç—å –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –æ–¥–Ω–æ—á–∞—Å–Ω–æ
- [ ] –ü–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—å —â–æ HP –≤–æ—Ä–æ–≥—ñ–≤ –ø—Ä–∏—Ö–æ–≤–∞–Ω—ñ –¥–ª—è –≥—Ä–∞–≤—Ü—ñ–≤

#### 7.3. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è Edge Cases
- [ ] –©–æ —è–∫—â–æ –≤—Å—ñ —É—á–∞—Å–Ω–∏–∫–∏ –≤ `unconscious`?
- [ ] –©–æ —è–∫—â–æ –µ—Ñ–µ–∫—Ç –∑–∞–∫—ñ–Ω—á–∏–≤—Å—è –≤ —Å–µ—Ä–µ–¥–∏–Ω—ñ —Ö–æ–¥—É?
- [ ] –©–æ —è–∫—â–æ –∫—Ä–∏—Ç–∏—á–Ω–∏–π –µ—Ñ–µ–∫—Ç –∑–º—ñ–Ω—é—î initiative?
- [ ] –©–æ —è–∫—â–æ –ø—Ä–∏–∑–∏–≤ –∑'—è–≤–ª—è—î—Ç—å—Å—è –≤ —Å–µ—Ä–µ–¥–∏–Ω—ñ —Ä–∞—É–Ω–¥—É?

---

## üîç –ê–ù–ê–õ–Ü–ó –ì–û–¢–û–í–ù–û–°–¢–Ü –î–û –†–ï–ê–õ–Ü–ó–ê–¶–Ü–á

### ‚úÖ –©–æ –≤–∂–µ –≥–æ—Ç–æ–≤–æ:
1. –ë–∞–∑–æ–≤–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ BattleScene –≤ –ë–î
2. –ü—Ä–æ—Å—Ç–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º –∞—Ç–∞–∫–∏ (–±–∞–∑–æ–≤–∏–π —É—Ä–æ–Ω, AC, –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∏)
3. –†–æ–∑—Ä–∞—Ö—É–Ω–∫–∏ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä—ñ–≤ (`getAbilityModifier`, `getProficiencyBonus`, —Ç–æ—â–æ)
4. –°–∏—Å—Ç–µ–º–∞ —ñ–º—É–Ω—ñ—Ç–µ—Ç—ñ–≤ —Ç–∞ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä—ñ–≤ —É—Ä–æ–Ω—É
5. –ë–∞–∑–æ–≤–∞ –ª–æ–≥—ñ–∫–∞ –∑–∞–∫–ª–∏–Ω–∞–Ω—å (—Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ DC, attack bonus)
6. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–∫—ñ–ª—ñ–≤ –∑ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è–º–∏ –∑–∞–∫–ª–∏–Ω–∞–Ω–Ω—è (–ø–æ–ª—è —î, –ª–æ–≥—ñ–∫–∏ –Ω–µ–º–∞—î)

### ‚ö†Ô∏è –©–æ –ø–æ—Ç—Ä–µ–±—É—î —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è:
1. BattleParticipant - –ø–æ—Ç—Ä—ñ–±–Ω–∞ –ø–æ–≤–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–º—ñ—Å—Ç—å `InitiativeParticipant`
2. –ê–∫—Ç–∏–≤–Ω—ñ –µ—Ñ–µ–∫—Ç–∏ - –ø–æ—Ç—Ä—ñ–±–Ω–∞ –ø–æ–≤–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ DOT/HOT
3. –ü–∞—Å–∏–≤–Ω—ñ –∑–¥—ñ–±–Ω–æ—Å—Ç—ñ - –ø–æ—Ç—Ä—ñ–±–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —Ç—Ä–∏–≥–µ—Ä—ñ–≤
4. –ú–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ –∑—ñ —Å–∫—ñ–ª—ñ–≤ - –ø–æ—Ç—Ä—ñ–±–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–∏—Ö –±–æ–Ω—É—Å—ñ–≤
5. –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è –∑–∞–∫–ª–∏–Ω–∞–Ω–Ω—è - –ø–æ—Ç—Ä—ñ–±–Ω–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –≤ –ª–æ–≥—ñ–∫—É –±–æ—é
6. –ú–æ—Ä–∞–ª—å - –ø–æ—Ç—Ä—ñ–±–Ω–µ –ø–æ–ª–µ —Ç–∞ –ª–æ–≥—ñ–∫–∞

### ‚ùå –©–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –∑ –Ω—É–ª—è:
1. CriticalEffect - –º–æ–¥–µ–ª—å —Ç–∞ CRUD
2. –ü–æ–≤–Ω–∞ –ª–æ–≥—ñ–∫–∞ –ø–æ—á–∞—Ç–∫—É —Ö–æ–¥—É (DOT, –∑–º–µ–Ω—à–µ–Ω–Ω—è —Ç—Ä–∏–≤–∞–ª–æ—Å—Ç—ñ, —Ç—Ä–∏–≥–µ—Ä–∏)
3. –ú–æ–¥–∞–ª—å–Ω—ñ –≤—ñ–∫–Ω–∞ –¥–ª—è –≤—Å—ñ—Ö –¥—ñ–π
4. UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –¥–ª—è –±–æ—é (ParticipantCard, ActionPanel)
5. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–∑–∏–≤–∞–Ω–Ω—è
6. –°–∏—Å—Ç–µ–º–∞ rollback

---

## üéØ –ü–†–Ü–û–†–ò–¢–ï–¢–ò –†–ï–ê–õ–Ü–ó–ê–¶–Ü–á

### –í–ò–°–û–ö–ò–ô –ü–†–Ü–û–†–ò–¢–ï–¢ (–ö—Ä–∏—Ç–∏—á–Ω–µ –¥–ª—è –±–∞–∑–æ–≤–æ–≥–æ –±–æ—é):
1. **BattleParticipant - –ø–æ–≤–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞** (–§–∞–∑–∞ 1.1)
2. **–°—Ç–∞—Ä—Ç –±–æ—é - —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è BattleParticipant** (–§–∞–∑–∞ 3.1)
3. **–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ Initiative** (–§–∞–∑–∞ 3.2)
4. **–ê—Ç–∞–∫–∞ - —Ä–æ–∑—à–∏—Ä–µ–Ω–∞ –ª–æ–≥—ñ–∫–∞** (–§–∞–∑–∞ 3.5) - –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏, —ñ–º—É–Ω—ñ—Ç–µ—Ç–∏
5. **–ë–∞–∑–æ–≤–∏–π UI –±–æ—é** (–§–∞–∑–∞ 4.2) - –∫–∞—Ä—Ç–∫–∏ —É—á–∞—Å–Ω–∏–∫—ñ–≤, –ø–∞–Ω–µ–ª—å –¥—ñ–π

### –°–ï–†–ï–î–ù–Ü–ô –ü–†–Ü–û–†–ò–¢–ï–¢ (–í–∞–∂–ª–∏–≤–æ –¥–ª—è –ø–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–æ–≥–æ –±–æ—é):
6. **–ü–æ—á–∞—Ç–æ–∫ —Ö–æ–¥—É (DOT, –µ—Ñ–µ–∫—Ç–∏)** (–§–∞–∑–∞ 3.3)
7. **–ó–∞–∫–ª–∏–Ω–∞–Ω–Ω—è - —Ä–æ–∑—à–∏—Ä–µ–Ω–∞ –ª–æ–≥—ñ–∫–∞** (–§–∞–∑–∞ 3.6)
8. **–ú–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ —É—Ä–æ–Ω—É –∑—ñ —Å–∫—ñ–ª—ñ–≤** (–§–∞–∑–∞ 2.1)
9. **–ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è –∑–∞–∫–ª–∏–Ω–∞–Ω–Ω—è** (–§–∞–∑–∞ 2.2)
10. **–ú–æ—Ä–∞–ª—å** (–§–∞–∑–∞ 1.6, 3.4)

### –ù–ò–ó–¨–ö–ò–ô –ü–†–Ü–û–†–ò–¢–ï–¢ (–ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è —Ç–∞ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è):
11. **–ü–∞—Å–∏–≤–Ω—ñ –∑–¥—ñ–±–Ω–æ—Å—Ç—ñ –∑ —Ç—Ä–∏–≥–µ—Ä–∞–º–∏** (–§–∞–∑–∞ 1.5)
12. **–ö—Ä–∏—Ç–∏—á–Ω—ñ –µ—Ñ–µ–∫—Ç–∏** (–§–∞–∑–∞ 1.3)
13. **–ü—Ä–∏–∑–∏–≤–∞–Ω–Ω—è** (–§–∞–∑–∞ 3.9)
14. **–ö–æ–Ω—Ç—Ä-—É–¥–∞—Ä** (–≤–∂–µ —á–∞—Å—Ç–∫–æ–≤–æ –≤ –§–∞–∑—ñ 3.5)
15. **Rollback** (–§–∞–∑–∞ 6.2)

---

## ‚ö†Ô∏è –í–ò–Ø–í–õ–ï–ù–Ü –ü–†–û–ë–õ–ï–ú–ò –¢–ê –†–ò–ó–ò–ö–ò

### 1. –°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó –°–∫—ñ–ª—ñ–≤
- **–ü—Ä–æ–±–ª–µ–º–∞:** –°–∫—ñ–ª–∏ –º–æ–∂—É—Ç—å –º–∞—Ç–∏ —Å–∫–ª–∞–¥–Ω—ñ —É–º–æ–≤–∏ —Ç–∞ –µ—Ñ–µ–∫—Ç–∏
- **–†—ñ—à–µ–Ω–Ω—è:** –°—Ç–≤–æ—Ä–∏—Ç–∏ —î–¥–∏–Ω—É –º–æ–¥–µ–ª—å `trigger` + `effect` –¥–ª—è –≤—Å—ñ—Ö –∑–¥—ñ–±–Ω–æ—Å—Ç–µ–π
- **–†–∏–∑–∏–∫:** –ú–æ–∂–ª–∏–≤—ñ –±–∞–≥–∏ –ø—Ä–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ–π —ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü—ñ—ó —É–º–æ–≤

### 2. –°—Ç–∞–∫—É–≤–∞–Ω–Ω—è –ú–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä—ñ–≤
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ë–µ–∑–ª—ñ—á –¥–∂–µ—Ä–µ–ª –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä—ñ–≤ (—Å–∫—ñ–ª–∏, –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∏, –ø–∞—Å–∏–≤–∫–∏, —Ä–∞—Å–æ–≤—ñ)
- **–†—ñ—à–µ–Ω–Ω—è:** –ß—ñ—Ç–∫–∏–π –ø–æ—Ä—è–¥–æ–∫ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è: –±–∞–∑–æ–≤–∏–π —É—Ä–æ–Ω ‚Üí % –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ ‚Üí flat –±–æ–Ω—É—Å–∏ ‚Üí —ñ–º—É–Ω—ñ—Ç–µ—Ç–∏
- **–†–∏–∑–∏–∫:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–µ —Å—Ç–∞–∫—É–≤–∞–Ω–Ω—è –º–æ–∂–µ –ø—Ä–∏–∑–≤–µ—Å—Ç–∏ –¥–æ –∑–∞–Ω–∞–¥—Ç–æ –≤–∏—Å–æ–∫–æ–≥–æ/–Ω–∏–∑—å–∫–æ–≥–æ —É—Ä–æ–Ω—É

### 3. –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è —á–µ—Ä–µ–∑ WebSocket
- **–ü—Ä–æ–±–ª–µ–º–∞:** –í—Å—ñ –≥—Ä–∞–≤—Ü—ñ –º–∞—é—Ç—å –±–∞—á–∏—Ç–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –æ–¥–Ω–æ—á–∞—Å–Ω–æ
- **–†—ñ—à–µ–Ω–Ω—è:** –¶–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π state –≤ –ë–î, broadcast —á–µ—Ä–µ–∑ WebSocket
- **–†–∏–∑–∏–∫:** –ó–∞—Ç—Ä–∏–º–∫–∏ –∞–±–æ –≤—Ç—Ä–∞—Ç–∞ –ø–∞–∫–µ—Ç—ñ–≤

### 4. Rollback - –°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å –í—ñ–¥–∫–æ—á—É–≤–∞–Ω–Ω—è
- **–ü—Ä–æ–±–ª–µ–º–∞:** –í—ñ–¥–º—ñ–Ω–∞ –¥—ñ—ó –ø–æ—Ç—Ä–µ–±—É—î –≤—ñ–¥–∫–æ—á—É–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö –∑–∞–ª–µ–∂–Ω–∏—Ö –∑–º—ñ–Ω
- **–†—ñ—à–µ–Ω–Ω—è:** –ó–±–µ—Ä—ñ–≥–∞—Ç–∏ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Å—Ç–∞–Ω –¥–ª—è –∫–æ–∂–Ω–æ—ó –¥—ñ—ó
- **–†–∏–∑–∏–∫:** –°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó —Ç–∞ –º–æ–∂–ª–∏–≤—ñ –±–∞–≥–∏

### 5. –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –ø—Ä–∏ –ë–∞–≥–∞—Ç—å–æ—Ö –£—á–∞—Å–Ω–∏–∫–∞—Ö
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ë–∞–≥–∞—Ç–æ —É—á–∞—Å–Ω–∏–∫—ñ–≤ ‚Üí –±–∞–≥–∞—Ç–æ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—ñ–≤
- **–†—ñ—à–µ–Ω–Ω—è:** –û–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ –∑–∞–ø–∏—Ç–∏ –¥–æ –ë–î, –∫–µ—à—É–≤–∞—Ç–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–∏
- **–†–∏–∑–∏–∫:** –ü–æ–≤—ñ–ª—å–Ω–∏–π UI –ø—Ä–∏ –≤–µ–ª–∏–∫–∏—Ö –±–∏—Ç–≤–∞—Ö

---

## üí° –†–ï–ö–û–ú–ï–ù–î–ê–¶–Ü–á –î–û –ü–û–ß–ê–¢–ö–£ –†–ï–ê–õ–Ü–ó–ê–¶–Ü–á

1. **–ü–æ—á–∞—Ç–∏ –∑ –ø—Ä–æ—Å—Ç–æ–≥–æ:**
   - –°–ø–æ—á–∞—Ç–∫—É —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –±–∞–∑–æ–≤—É –∞—Ç–∞–∫—É –∑ —É—Å—ñ–º–∞ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∞–º–∏
   - –ü–æ—Ç—ñ–º –¥–æ–¥–∞—Ç–∏ –∑–∞–∫–ª–∏–Ω–∞–Ω–Ω—è
   - –ü–æ—Ç—ñ–º –¥–æ–¥–∞—Ç–∏ —Å–∫–ª–∞–¥–Ω—ñ –º–µ—Ö–∞–Ω—ñ–∫–∏ (–º–æ—Ä–∞–ª—å, –µ—Ñ–µ–∫—Ç–∏, —Ç–æ—â–æ)

2. **–°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–µ—Å—Ç–∏ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –º–µ—Ö–∞–Ω—ñ–∫:**
   - –¢–µ—Å—Ç–∏ –¥–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É —É—Ä–æ–Ω—É –∑ —É—Å—ñ–º–∞ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∞–º–∏
   - –¢–µ—Å—Ç–∏ –¥–ª—è —ñ–º—É–Ω—ñ—Ç–µ—Ç—ñ–≤ —Ç–∞ –æ–ø–æ—Ä—É
   - –¢–µ—Å—Ç–∏ –¥–ª—è –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–∏—Ö –±–æ–Ω—É—Å—ñ–≤

3. **–î–æ–∫—É–º–µ–Ω—Ç—É–≤–∞—Ç–∏ –ª–æ–≥—ñ–∫—É –∫–æ–∂–Ω–æ–≥–æ —Å–∫—ñ–ª—É:**
   - –î–ª—è –∫–æ–∂–Ω–æ–≥–æ —Å–∫—ñ–ª—É —Å—Ç–≤–æ—Ä–∏—Ç–∏ –ø—Å–µ–≤–¥–æ–∫–æ–¥–æ–≤–∏–π –æ–ø–∏—Å —è–∫ –≤—ñ–Ω –ø—Ä–∞—Ü—é—î –≤ –±–æ—é
   - –¶–µ –¥–æ–ø–æ–º–æ–∂–µ —É–Ω–∏–∫–Ω—É—Ç–∏ –±–∞–≥—ñ–≤ —Ç–∞ –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ—Å—Ç–µ–π

4. **–ü–æ–µ—Ç–∞–ø–Ω–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è:**
   - –ü—ñ—Å–ª—è –∫–æ–∂–Ω–æ—ó —Ñ–∞–∑–∏ —Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –∑ —Ä–µ–∞–ª—å–Ω–∏–º–∏ –≥—Ä–∞–≤—Ü—è–º–∏
   - –ó–±–∏—Ä–∞—Ç–∏ feedback —Ç–∞ –≤–∏–ø—Ä–∞–≤–ª—è—Ç–∏ –±–∞–≥–∏

---

## üìù –í–ò–°–ù–û–í–û–ö

**–ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω:** –°–∏—Å—Ç–µ–º–∞ –º–∞—î –º—ñ—Ü–Ω—É –æ—Å–Ω–æ–≤—É (—Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–∏, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–∞–Ω–∏—Ö, –±–∞–∑–æ–≤–∏–π –±—ñ–π), –∞–ª–µ –ø–æ—Ç—Ä–µ–±—É—î –∑–Ω–∞—á–Ω–æ–≥–æ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è –¥–ª—è –ø–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–æ–≥–æ –±–æ—é –∑ —É—Å—ñ–º–∞ –º–µ—Ö–∞–Ω—ñ–∫–∞–º–∏.

**–ì–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å –¥–æ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó:** ~60%
- ‚úÖ –ë–∞–∑–æ–≤—ñ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–∏ –≥–æ—Ç–æ–≤—ñ
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–∞–Ω–∏—Ö —á–∞—Å—Ç–∫–æ–≤–æ –≥–æ—Ç–æ–≤—ñ
- ‚ö†Ô∏è –ü–æ—Ç—Ä—ñ–±–Ω–µ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è BattleParticipant
- ‚ùå –í—ñ–¥—Å—É—Ç–Ω—ñ —Å–∫–ª–∞–¥–Ω—ñ –º–µ—Ö–∞–Ω—ñ–∫–∏ (–µ—Ñ–µ–∫—Ç–∏, —Ç—Ä–∏–≥–µ—Ä–∏, –º–æ—Ä–∞–ª—å)

**–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥:** –ü–æ–µ—Ç–∞–ø–Ω–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø–æ —Ñ–∞–∑–∞—Ö, –ø–æ—á–∏–Ω–∞—é—á–∏ –∑ –≤–∏—Å–æ–∫–æ–≥–æ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç—É.
