# D&D Battle System - –ü—Ä–æ–≥—Ä–µ—Å –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó

**–û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è:** 2026-01-23

## üìä –ó–∞–≥–∞–ª—å–Ω–∏–π –ü—Ä–æ–≥—Ä–µ—Å

| –§–∞–∑–∞                        | –ó–∞–≥–∞–ª–æ–º –∑–∞–≤–¥–∞–Ω—å | –í–∏–∫–æ–Ω–∞–Ω–æ | –í –ø—Ä–æ–≥—Ä–µ—Å—ñ | –ü—Ä–æ–≥—Ä–µ—Å |
| --------------------------- | --------------- | -------- | ---------- | ------- |
| –§–∞–∑–∞ 1: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö     | 6               | 6        | 0          | 100%    |
| –§–∞–∑–∞ 2: –†–æ–∑—Ä–∞—Ö—É–Ω–∫–∏          | 4               | 4        | 0          | 100%    |
| –§–∞–∑–∞ 3: –õ–æ–≥—ñ–∫–∞ –±–æ—é          | 10              | 7        | 0          | 70%     |
| –§–∞–∑–∞ 4: –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å           | 4               | 3        | 0          | 75%     |
| –§–∞–∑–∞ 5: WebSocket           | 2               | 0        | 0          | 0%      |
| –§–∞–∑–∞ 6: –Ü—Å—Ç–æ—Ä—ñ—è —Ç–∞ Rollback | 2               | 0        | 0          | 0%      |
| –§–∞–∑–∞ 7: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è          | 3               | 0        | 0          | 0%      |
| **–í–°–¨–û–ì–û**                  | **31**          | **20**   | **0**      | **65%** |

---

## ‚úÖ –í–ò–ö–û–ù–ê–ù–û

### ‚úÖ –î–æ–¥–∞–Ω–æ –ø–æ–ª–µ `morale` –≤ Character —Ç–∞ Unit

- [x] –î–æ–¥–∞–Ω–æ `morale Int @default(0)` –≤ Prisma schema –¥–ª—è Character
- [x] –î–æ–¥–∞–Ω–æ `morale Int @default(0)` –≤ Prisma schema –¥–ª—è Unit
- [x] –°—Ç–≤–æ—Ä–µ–Ω–æ –º—ñ–≥—Ä–∞—Ü—ñ—é `20260118224328_add_morale_to_characters_and_units`
- [x] –û–Ω–æ–≤–ª–µ–Ω–æ Zod —Å—Ö–µ–º–∏ (createCharacterSchema, updateCharacterSchema, createUnitSchema, updateUnitSchema)
- [x] –û–Ω–æ–≤–ª–µ–Ω–æ TypeScript —Ç–∏–ø–∏ (CharacterFormData, Character, BattleParticipant)

### ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∏ –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –µ—Ñ–µ–∫—Ç—ñ–≤

- [x] –°—Ç–≤–æ—Ä–µ–Ω–æ `/lib/constants/critical-effects.ts`
- [x] –î–æ–¥–∞–Ω–æ `CRITICAL_SUCCESS_EFFECTS` (10 –µ—Ñ–µ–∫—Ç—ñ–≤ –¥–ª—è Natural 20)
- [x] –î–æ–¥–∞–Ω–æ `CRITICAL_FAIL_EFFECTS` (10 –µ—Ñ–µ–∫—Ç—ñ–≤ –¥–ª—è Natural 1)
- [x] –î–æ–¥–∞–Ω–æ —Ñ—É–Ω–∫—Ü—ñ—ó `getCriticalEffect()` —Ç–∞ `getRandomCriticalEffect()`

### ‚úÖ –û–Ω–æ–≤–ª–µ–Ω–æ —Ç–∏–ø–∏ BattleParticipant

- [x] –î–æ–¥–∞–Ω–æ –ø–æ–ª–µ `morale` –≤ `BattleParticipant` interface

---

## üìã –î–ï–¢–ê–õ–¨–ù–ò–ô –°–ü–ò–°–û–ö –ó–ê–í–î–ê–ù–¨

### –§–ê–ó–ê 1: –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è –°—Ç—Ä—É–∫—Ç—É—Ä–∏ –î–∞–Ω–∏—Ö

#### 1.1. BattleParticipant - –ü–æ–≤–Ω–∞ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

- [x] –°—Ç–≤–æ—Ä–∏—Ç–∏ –ø–æ–≤–Ω—É –º–æ–¥–µ–ª—å `BattleParticipant` –≤ TypeScript
- [x] –î–æ–¥–∞—Ç–∏ –ø–æ–ª—è: `activeEffects`, `passiveAbilities`, `racialAbilities`, `activeSkills`, `equippedArtifacts`
- [x] –î–æ–¥–∞—Ç–∏ —Ñ–ª–∞–≥–∏: `hasUsedAction`, `hasUsedBonusAction`, `hasUsedReaction`, `hasExtraTurn`
- [x] –†–æ–∑—à–∏—Ä–∏—Ç–∏ `initiativeOrder` –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –ø–æ–≤–Ω–∏—Ö BattleParticipant

#### 1.2. BattleAction - –î–µ—Ç–∞–ª—å–Ω–∞ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

- [x] –°—Ç–≤–æ—Ä–∏—Ç–∏ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å `BattleAction` –∑ —É—Å—ñ–º–∞ –ø–æ–ª—è–º–∏
- [ ] –†–æ–∑—à–∏—Ä–∏—Ç–∏ `battleLog` –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è BattleAction –∑–∞–º—ñ—Å—Ç—å –ø—Ä–æ—Å—Ç–∏—Ö –∑–∞–ø–∏—Å—ñ–≤
- [x] –î–æ–¥–∞—Ç–∏ –ø–æ–ª—è: `actionDetails`, `hpChanges`, `isCancelled` (–≤–∫–ª—é—á–µ–Ω–æ –≤ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å)

#### 1.3. CriticalEffect - –ë–∞–∑–∞ –ö—Ä–∏—Ç–∏—á–Ω–∏—Ö –ï—Ñ–µ–∫—Ç—ñ–≤

- [x] –°—Ç–≤–æ—Ä–µ–Ω–æ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∏ –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –µ—Ñ–µ–∫—Ç—ñ–≤ (`/lib/constants/critical-effects.ts`)
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ –º–æ–¥–µ–ª—å `CriticalEffect` –≤ Prisma schema (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ - –º–æ–∂–Ω–∞ –∑–∞–ª–∏—à–∏—Ç–∏ –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞—Ö)
- [ ] –î–æ–¥–∞—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—é –¥–ª—è —Ç–∞–±–ª–∏—Ü—ñ `critical_effects` (—è–∫—â–æ –≤–∏—Ä—ñ—à–µ–Ω–æ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –≤ –ë–î)
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ API routes –¥–ª—è CRUD –æ–ø–µ—Ä–∞—Ü—ñ–π –∑ –∫—Ä–∏—Ç–∏—á–Ω–∏–º–∏ –µ—Ñ–µ–∫—Ç–∞–º–∏ (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –î–æ–¥–∞—Ç–∏ UI –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫—Ä–∏—Ç–∏—á–Ω–∏–º–∏ –µ—Ñ–µ–∫—Ç–∞–º–∏ (DM) (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)

#### 1.4. –ê–∫—Ç–∏–≤–Ω—ñ –ï—Ñ–µ–∫—Ç–∏ (ActiveEffects)

- [x] –°—Ç–≤–æ—Ä–∏—Ç–∏ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å `ActiveEffect` –∑ –ø–æ–ª—è–º–∏: `id`, `name`, `type`, `duration`, `effects[]`, `dotDamage?`
- [x] –î–æ–¥–∞—Ç–∏ –ª–æ–≥—ñ–∫—É –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è DOT –Ω–∞ –ø–æ—á–∞—Ç–∫—É —Ö–æ–¥—É (`applyDOTEffects` —É—Ç–∏–ª—ñ—Ç–∞)
- [x] –î–æ–¥–∞—Ç–∏ –ª–æ–≥—ñ–∫—É –∑–º–µ–Ω—à–µ–Ω–Ω—è —Ç—Ä–∏–≤–∞–ª–æ—Å—Ç—ñ –µ—Ñ–µ–∫—Ç—ñ–≤ (`decreaseEffectDurations` —É—Ç–∏–ª—ñ—Ç–∞)
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–∏—Ö –µ—Ñ–µ–∫—Ç—ñ–≤ –Ω–∞ –∫–∞—Ä—Ç—Ü—ñ —É—á–∞—Å–Ω–∏–∫–∞

#### 1.5. –ü–∞—Å–∏–≤–Ω—ñ –ó–¥—ñ–±–Ω–æ—Å—Ç—ñ –∑ –¢—Ä–∏–≥–µ—Ä–∞–º–∏

- [x] –°—Ç–≤–æ—Ä–∏—Ç–∏ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å `PassiveAbility` –∑ `trigger` —Ç–∞ `effect`
- [x] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –±–∞–∑–æ–≤—É —Å–∏—Å—Ç–µ–º—É —Ç—Ä–∏–≥–µ—Ä—ñ–≤ (`checkTriggerCondition`, `getPassiveAbilitiesByTrigger` —É—Ç–∏–ª—ñ—Ç–∏)
- [x] –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ç—Ä–∏–≥–µ—Ä—ñ–≤ (`checkTriggerCondition` —É—Ç–∏–ª—ñ—Ç–∞)
- [x] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –æ–±—Ä–æ–±–∫—É —É–º–æ–≤ (`evaluateCondition` —É—Ç–∏–ª—ñ—Ç–∞)
- [x] –î–æ–¥–∞—Ç–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫—É `chance` (–≤—ñ–¥—Å–æ—Ç–æ–∫ —Å–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è) –≤ –±–∞–∑–æ–≤—ñ–π –ª–æ–≥—ñ—Ü—ñ
- [x] **–ù–û–í–û:** –î–æ–¥–∞—Ç–∏ –ø–æ–ª–µ `skillTriggers` –≤ `ActiveSkill` –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Ç—Ä–∏–≥–µ—Ä—ñ–≤ —Å–∫—ñ–ª—ñ–≤
- [x] **–ù–û–í–û:** –°—Ç–≤–æ—Ä–∏—Ç–∏ —É—Ç–∏–ª—ñ—Ç–∏ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ —Ç—Ä–∏–≥–µ—Ä–∞–º–∏ —Å–∫—ñ–ª—ñ–≤ (`evaluateSkillTrigger`, `getSkillsByTrigger`)
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ç—Ä–∏–≥–µ—Ä—ñ–≤ –ø—Ä–∏ –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—ñ —É–º–æ–≤
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –±–æ–Ω—É—Å–Ω–∏—Ö –¥—ñ–π –∑ —Ç—Ä–∏–≥–µ—Ä—ñ–≤ –≤ –ø–∞–Ω–µ–ª—ñ –¥—ñ–π

#### 1.6. –ú–æ—Ä–∞–ª—å (Morale)

- [x] –î–æ–¥–∞–Ω–æ –ø–æ–ª–µ `morale` (number, -3 –¥–æ +3) –≤ Character/Unit schema
- [x] –°—Ç–≤–æ—Ä–µ–Ω–æ –º—ñ–≥—Ä–∞—Ü—ñ—é –¥–ª—è `morale` –ø–æ–ª—è
- [x] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –º–æ—Ä–∞–ª—ñ –Ω–∞ –ø–æ—á–∞—Ç–∫—É —Ö–æ–¥—É (`checkMorale` —É—Ç–∏–ª—ñ—Ç–∞)
- [x] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —à–∞–Ω—Å—É –¥–æ–¥–∞—Ç–∫–æ–≤–æ–≥–æ —Ö–æ–¥—É / –ø—Ä–æ–ø—É—Å–∫—É —Ö–æ–¥—É (–≤ `checkMorale`)
- [ ] –î–æ–¥–∞—Ç–∏ UI –¥–ª—è –≤–≤–µ–¥–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É 1d10 (–±—É–¥–µ –≤ –§–∞–∑—ñ 4)

---

### –§–ê–ó–ê 2: –†–æ–∑—Ä–∞—Ö—É–Ω–∫–∏ —Ç–∞ –ú–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏

#### 2.1. –ú–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ –£—Ä–æ–Ω—É –∑—ñ –°–∫—ñ–ª—ñ–≤

- [x] –†–æ–∑—à–∏—Ä–∏—Ç–∏ `activeSkills` –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –µ—Ñ–µ–∫—Ç—ñ–≤ —Å–∫—ñ–ª—ñ–≤ –∑ –±–æ—é (–≤–∂–µ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è)
- [x] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –æ–±—Ä–æ–±–∫—É –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–∏—Ö –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä—ñ–≤ (`calculateSkillDamagePercentBonus`, `calculateSkillDamageFlatBonus`)
- [x] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Å—Ç–∞–∫—É–≤–∞–Ω–Ω—è –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–∏—Ö –±–æ–Ω—É—Å—ñ–≤ (–∞–¥–∏—Ç–∏–≤–Ω–æ) (–≤ `calculateDamageWithModifiers`)
- [x] –î–æ–¥–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é `calculateDamageWithModifiers()` —è–∫–∞ –≤—Ä–∞—Ö–æ–≤—É—î –≤—Å—ñ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏

#### 2.2. –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è –ó–∞–∫–ª–∏–Ω–∞–Ω–Ω—è (Spell Enhancements)

- [x] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è `spellEffectIncrease` (+25% —É—Ä–æ–Ω—É) (`calculateSpellEffectIncrease`)
- [x] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ `spellTargetChange` (–∑–º—ñ–Ω–∞ —Ü—ñ–ª—ñ) (`getSpellTargetChange`)
- [x] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ `spellAdditionalModifier` (–¥–æ–¥–∞—Ç–∫–æ–≤–∏–π —É—Ä–æ–Ω –∑ –∫—É–±–∏–∫—ñ–≤) (`calculateSpellAdditionalModifier`)
- [x] –î–æ–¥–∞—Ç–∏ –ª–æ–≥—ñ–∫—É –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –ø–æ–∫—Ä–∞—â–µ–Ω—å –∑–∞–∫–ª–∏–Ω–∞–Ω–Ω—è –ø—Ä–∏ –∫–∞—Å—Ç—ñ (`calculateSpellDamageWithEnhancements`)

#### 2.3. –ê—Ä—Ç–µ—Ñ–∞–∫—Ç–∏ –≤ –ë–æ—é

- [x] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è `equippedArtifacts` –≤ BattleParticipant –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ –±–æ—é (–∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è –∑ –ë–î)
- [x] –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –±–æ–Ω—É—Å–∏ –∑ `bonuses` (flat –∑–Ω–∞—á–µ–Ω–Ω—è) (–≤ `calculateArtifactDamageBonus`)
- [x] –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ –∑ `modifiers` (flat –∞–±–æ percentage) (–≤ `calculateArtifactDamageBonus`)
- [x] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –ø–∞—Å–∏–≤–Ω—ñ –∑–¥—ñ–±–Ω–æ—Å—Ç—ñ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ñ–≤ (`passiveAbility`) (–≤ `calculatePassiveAbilityDamageBonus`)

#### 2.4. –†–∞—Å–æ–≤—ñ –ó–¥—ñ–±–Ω–æ—Å—Ç—ñ —Ç–∞ –Ü–º—É–Ω—ñ—Ç–µ—Ç–∏

- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è `racialAbilities` –≤ BattleParticipant
- [ ] –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ —ñ–º—É–Ω—ñ—Ç–µ—Ç–∏ –ø—Ä–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É —É—Ä–æ–Ω—É (fire_immunity ‚Üí —É—Ä–æ–Ω = 0)
- [ ] –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –æ–ø—ñ—Ä (resistance) –ø—Ä–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É —É—Ä–æ–Ω—É (50% –æ–ø—ñ—Ä ‚Üí —É—Ä–æ–Ω √ó 0.5)
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, necromancer morale = 0)

#### 2.5. –°–∫–ª–∞–¥–Ω—ñ –§–æ—Ä–º—É–ª–∏ –ï—Ñ–µ–∫—Ç—ñ–≤ (–ù–û–í–ï)

- [x] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –ø–∞—Ä—Å–µ—Ä —Ñ–æ—Ä–º—É–ª (`FormulaEvaluator`)
- [x] –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –∑–º—ñ–Ω–Ω–∏—Ö: `hero_level`, `maxHP`, `currentHP`, `lost_hp_percent`, `spell_power`
- [x] –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ —Ñ—É–Ω–∫—Ü—ñ–π: `floor()`, `ceil()`, `max()`, `min()`
- [x] –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è —Ñ–æ—Ä–º—É–ª –≤ —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —É—Ä–æ–Ω—É

---

### –§–ê–ó–ê 3: –õ–æ–≥—ñ–∫–∞ –ë–æ—é

#### 3.0. –°–∫–ª–∞–¥–Ω—ñ –¢—Ä–∏–≥–µ—Ä–∏ (–ù–û–í–ï)

- [x] –†–æ–∑—à–∏—Ä–∏—Ç–∏ —Å–∏—Å—Ç–µ–º—É —Ç—Ä–∏–≥–µ—Ä—ñ–≤ –¥–ª—è –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ –≤–∏—Ä–∞–∑—ñ–≤: `"onHit && rand() < 0.4"`
- [x] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –ø–∞—Ä—Å–µ—Ä —Ç—Ä–∏–≥–µ—Ä—ñ–≤ (`TriggerEvaluator`)
- [x] –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –ø–æ–¥—ñ–π: `onHit`, `onKill`, `onFirstGivenHit`, `onBattleStart`, `bonusAction`
- [x] –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ —É–º–æ–≤: `allyHP <= X`, `enemyCount > Y`

#### 3.1. –°—Ç–∞—Ä—Ç –ë–æ—é - –°—Ç–≤–æ—Ä–µ–Ω–Ω—è BattleParticipant

- [x] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –ø–æ–≤–Ω–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è Character –≤ BattleParticipant (—á–µ—Ä–µ–∑ `createBattleParticipantFromCharacter`)
- [x] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –ø–æ–≤–Ω–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è Unit –≤ BattleParticipant (—á–µ—Ä–µ–∑ `createBattleParticipantFromUnit`, –∑ instanceNumber)
- [x] –†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ –≤—Å—ñ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
- [x] –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∞–∫—Ç–∏–≤–Ω—ñ —Å–∫—ñ–ª–∏ –∑ `skillTreeProgress` (–ø–æ–≤–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ –ë–î: name, effects, spellEnhancements)
- [x] –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –µ–∫—ñ–ø—ñ—Ä–æ–≤–∞–Ω—ñ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∏ –∑ inventory (–ø–æ–≤–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ –ë–î: bonuses, modifiers, passiveAbility)
- [x] –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –ø–æ—á–∞—Ç–∫–æ–≤—ñ –µ—Ñ–µ–∫—Ç–∏ –∑ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ñ–≤/–ø–∞—Å–∏–≤–æ–∫ (`applyStartOfBattleEffects`)

#### 3.2. –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ Initiative

- [x] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ `baseInitiative` –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —É—á–∞—Å–Ω–∏–∫–∞ (–≤–∂–µ —î –≤ BattleParticipant)
- [x] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞ (–§–∞–π–¥–∞–µ–Ω = initiative 999) (`calculateInitiative`)
- [x] –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ —Ç–∏–º—á–∞—Å–æ–≤—ñ –±–æ–Ω—É—Å–∏ –¥–æ initiative (–∑ activeEffects –≤ `calculateInitiative`)
- [x] –í—ñ–¥—Å–æ—Ä—Ç—É–≤–∞—Ç–∏ `initiativeOrder` –∑–∞ initiative, baseInitiative, dexterity (`sortByInitiative`)

#### 3.3. –ü–æ—á–∞—Ç–æ–∫ –•–æ–¥—É (Start of Turn)

- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –≥—Ä–∞–≤—Ü—è (–±—É–¥–µ –≤ UI)
- [x] –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ DOT –µ—Ñ–µ–∫—Ç–∏ (damagePerRound) (`processStartOfTurn`)
- [x] –ó–º–µ–Ω—à–∏—Ç–∏ —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –≤—Å—ñ—Ö –µ—Ñ–µ–∫—Ç—ñ–≤ (`decreaseEffectDurations`)
- [x] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø–∞—Å–∏–≤–∫–∏ –∑ `start_of_turn` —Ç—Ä–∏–≥–µ—Ä–æ–º (`getPassiveAbilitiesByTrigger`)
- [x] –°–∫–∏–Ω—É—Ç–∏ —Ñ–ª–∞–≥–∏ –¥—ñ–π (`hasUsedAction`, `hasUsedBonusAction`, `hasUsedReaction`) (`processStartOfTurn`)

#### 3.4. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ú–æ—Ä–∞–ª—ñ

- [x] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ UI –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –º–æ—Ä–∞–ª—ñ (–ø–æ–ø–∞–ø –∑ 1d10) (`MoraleCheckDialog`)
- [x] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ä–∞—Å–æ–≤—ñ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ –º–æ—Ä–∞–ª—ñ (`checkMorale`)
- [x] –†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ —à–∞–Ω—Å —Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç (`checkMorale`)
- [x] –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ `hasExtraTurn` –∞–±–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–∏ —Ö—ñ–¥ (`/morale-check/route.ts`)

#### 3.5. –ê—Ç–∞–∫–∞ - –†–æ–∑—à–∏—Ä–µ–Ω–∞ –õ–æ–≥—ñ–∫–∞

- [x] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –≤–∏–±—ñ—Ä –∑–±—Ä–æ—ó –∑ `attacks` (`AttackDialog`)
- [x] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –≤–∏–±—ñ—Ä —Ü—ñ–ª—ñ (–æ–¥–Ω–∞ —Ü—ñ–ª—å –∞–±–æ AOE) (`AttackDialog` - –ø–æ–∫–∏ –æ–¥–Ω–∞ —Ü—ñ–ª—å)
- [x] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ Attack Roll –∑ —É—Å—ñ–º–∞ –±–æ–Ω—É—Å–∞–º–∏ (`calculateAttackRoll`, `calculateAttackBonus`)
- [x] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ Advantage –¥–ª—è –µ–ª—å—Ñ—ñ–≤ (ranged –∞—Ç–∞–∫–∏) (`hasAdvantage`, UI –≤ `AttackDialog`)
- [x] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∫—Ä–∏—Ç–∏—á–Ω–µ –ø–æ–ø–∞–¥–∞–Ω–Ω—è (20) —Ç–∞ –≤–∏–±—ñ—Ä CriticalEffect (`getRandomCriticalEffect`, `applyCriticalEffect`)
- [x] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∫—Ä–∏—Ç–∏—á–Ω–∏–π –ø—Ä–æ–º–∞—Ö (1) —Ç–∞ –≤–∏–±—ñ—Ä CriticalEffect (`getRandomCriticalEffect`)
- [x] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ Damage Roll –∑ –∫—É–±–∏–∫–∞–º–∏ –æ–∫—Ä–µ–º–æ (`AttackDialog` - –ø–æ–ª—è –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∫—É–±–∏–∫–∞)
- [x] –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –≤—Å—ñ –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ñ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ –∑—ñ —Å–∫—ñ–ª—ñ–≤ (`calculateDamageWithModifiers`)
- [x] –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –±–æ–Ω—É—Å–∏ –∑ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ñ–≤ (`calculateDamageWithModifiers`)
- [x] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø–∞—Å–∏–≤–∫–∏ –∑ —Ç—Ä–∏–≥–µ—Ä–∞–º–∏ (`on_attack`, `ally_low_hp`) (`getPassiveAbilitiesByTrigger`)
- [x] –î–æ–¥–∞—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ —É—Ä–æ–Ω—É (–ø—ñ–¥–ø–∞–ª, –æ—Ç—Ä—É—Ç–∞) (`processAttack`)
- [x] –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –æ–ø—ñ—Ä/—ñ–º—É–Ω—ñ—Ç–µ—Ç —Ü—ñ–ª—ñ (`applyResistance`)
- [x] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∫–æ–Ω—Ç—Ä-—É–¥–∞—Ä (Reaction) —è–∫—â–æ —É–º–æ–≤–∏ –≤–∏–∫–æ–Ω–∞–Ω—ñ (`canPerformReaction`, `performReaction`)

#### 3.6. –ó–∞–∫–ª–∏–Ω–∞–Ω–Ω—è - –†–æ–∑—à–∏—Ä–µ–Ω–∞ –õ–æ–≥—ñ–∫–∞

- [x] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ UI –≤–∏–±–æ—Ä—É –∑–∞–∫–ª–∏–Ω–∞–Ω–Ω—è –∑ –ø–æ–∫–∞–∑–æ–º spell slots (`SpellDialog`)
- [x] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–∫–ª–∏–Ω–∞–Ω–Ω—è (spell slots, –æ–±–º–µ–∂–µ–Ω–Ω—è) (`processSpell`, `/spell/route.ts`)
- [x] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –≤–∏–±—ñ—Ä —Ü—ñ–ª–µ–π (Target vs AOE) (`SpellDialog` - —á–µ–∫–±–æ–∫—Å–∏ –¥–ª—è –º–Ω–æ–∂–∏–Ω–Ω–æ–≥–æ –≤–∏–±–æ—Ä—É)
- [x] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ Saving Throws –¥–ª—è –∫–æ–∂–Ω–æ—ó —Ü—ñ–ª—ñ (`processSpell`, UI –≤ `SpellDialog`)
- [x] –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –∑–∞–∫–ª–∏–Ω–∞–Ω–Ω—è (`spellEffectIncrease`, `spellAdditionalModifier`) (`calculateSpellDamageWithEnhancements`)
- [x] –†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ —É—Ä–æ–Ω/–ª—ñ–∫—É–≤–∞–Ω–Ω—è –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –≤—Å—ñ—Ö –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä—ñ–≤ (`processSpell`)
- [x] –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ DOT/HOT –µ—Ñ–µ–∫—Ç–∏ –∑ –∑–∞–∫–ª–∏–Ω–∞–Ω–Ω—è (`addActiveEffect` –∑ `dotDamage`)
- [x] –ó–º–µ–Ω—à–∏—Ç–∏ spell slot –ø—ñ—Å–ª—è –∫–∞—Å—Ç—É (`processSpell`)

#### 3.7. –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è –•–æ–¥—É

- [x] –û–±—Ä–æ–±–∏—Ç–∏ `hasExtraTurn` (–ø–æ–≤—Ç–æ—Ä Start of Turn) (`processEndOfTurn`)
- [x] –ü–µ—Ä–µ–π—Ç–∏ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —É—á–∞—Å–Ω–∏–∫–∞ (`processEndOfTurn`)
- [x] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ —Ä–∞—É–Ω–¥ –∑–∞–∫—ñ–Ω—á–∏–≤—Å—è ‚Üí Start of Round (`processEndOfTurn`, `/next-turn/route.ts`)

#### 3.8. –ü–æ—á–∞—Ç–æ–∫ –†–∞—É–Ω–¥—É

- [x] –ü–µ—Ä–µ—Å–æ—Ä—Ç—É–≤–∞—Ç–∏ `initiativeOrder` –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –∑–º—ñ–Ω (`processStartOfRound`)
- [ ] –î–æ–¥–∞—Ç–∏ `pendingSummons` –≤ `initiativeOrder` (–ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–¥–∞—Ç–∏ –ø–æ–ª–µ –≤ —Å—Ö–µ–º—É)
- [ ] –û—á–∏—Å—Ç–∏—Ç–∏ `pendingSummons` (–ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–¥–∞—Ç–∏ –ø–æ–ª–µ –≤ —Å—Ö–µ–º—É)
- [x] –ó–∞–ø–∏—Å–∞—Ç–∏ –≤ –ª–æ–≥ "üîÅ –ü–æ—á–∞—Ç–æ–∫ –†–∞—É–Ω–¥—É X" (`processStartOfRound`)

#### 3.9. –ü—Ä–∏–∑–∏–≤–∞–Ω–Ω—è (Summons)

- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –ø—Ä–∏–∑–≤–∞–Ω–∏—Ö (< 3)
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –±–æ–Ω—É—Å –¥—ñ—é –¥–ª—è –ø—Ä–∏–∑–∏–≤—É (–ê–≥—Ä–∞—ó–ª)
- [ ] –î–æ–¥–∞—Ç–∏ –ø—Ä–∏–∑–≤–∞–Ω—É —ñ—Å—Ç–æ—Ç—É –≤ `pendingSummons` –∑ initiative
- [ ] –ü—Ä–∏–∑–≤–∞–Ω—ñ –æ—Ç—Ä–∏–º—É—é—Ç—å 200% —É—Ä–æ–Ω—É

#### 3.10. –ü–µ—Ä–µ–º–æ–≥–∞ —Ç–∞ –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è –ë–æ—é

- [x] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —É–º–æ–≤–∏ –ø–µ—Ä–µ–º–æ–≥–∏ (–≤—Å—ñ –≤–æ—Ä–æ–≥–∏ unconscious/dead) (`checkVictoryConditions`)
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∫–Ω–æ–ø–∫—É "–ó–∞–≤–µ—Ä—à–∏—Ç–∏ –±—ñ–π" –¥–ª—è DM (–±—É–¥–µ –≤ UI)
- [x] –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ `status = "completed"`, `result = "victory" | "defeat"` (`completeBattle`)
- [x] –í—ñ–¥–Ω–æ–≤–∏—Ç–∏ HP –≤—Å—ñ—Ö unconscious —Å–æ—é–∑–Ω–∏–∫—ñ–≤ –¥–æ `maxHp` (–ø—Ä–∏ –ø–µ—Ä–µ–º–æ–∑—ñ) (`completeBattle`)

---

### –§–ê–ó–ê 4: –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ç–∞ UI

#### 4.1. –°—Ç–æ—Ä—ñ–Ω–∫–∞ –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∏ –ë–æ—é (`/dm/battles/new`)

- [x] –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ–æ—Ä–º—É –∑ –ø–æ–ª—è–º–∏ –Ω–∞–∑–≤–∏ —Ç–∞ –æ–ø–∏—Å—É
- [x] –ü–æ–∫–∞–∑–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ Player Characters –∑ —á–µ–∫–±–æ–∫—Å–∞–º–∏
- [x] –ü–æ–∫–∞–∑–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ NPC Heroes –∑ —á–µ–∫–±–æ–∫—Å–∞–º–∏
- [x] –ü–æ–∫–∞–∑–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ NPC Units –∑ —á–µ–∫–±–æ–∫—Å–∞–º–∏ —Ç–∞ –ø–æ–ª–µ–º quantity
- [x] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –¥–≤–∞ —Å—Ç–æ–≤–ø—Ü—ñ: "–°–æ—é–∑–Ω–∏–∫–∏" —Ç–∞ "–í–æ—Ä–æ–≥–∏"
- [x] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ drag & drop –º—ñ–∂ —Å—Ç–æ–≤–ø—Ü—è–º–∏ (–∞–±–æ –∫–Ω–æ–ø–∫–∏) (–∫–Ω–æ–ø–∫–∏ ‚Üê ‚Üí)
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∫–Ω–æ–ø–∫—É "–î—É–±–ª—é–≤–∞—Ç–∏" –¥–ª—è —ñ—Å–Ω—É—é—á–∏—Ö —Å—Ü–µ–Ω (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)

#### 4.1.5. –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –°–∫—ñ–ª–∞–º–∏ —Ç–∞ –ï—Ñ–µ–∫—Ç–∞–º–∏ (–ù–û–í–ï)

- [ ] UI –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–∏—Ö —Å–∫—ñ–ª—ñ–≤ (Admin/DM)
- [ ] –†–µ–¥–∞–∫—Ç–æ—Ä —Ñ–æ—Ä–º—É–ª —Ç–∞ —Ç—Ä–∏–≥–µ—Ä—ñ–≤ (–∑ –≤–∞–ª—ñ–¥–∞—Ü—ñ—î—é)
- [ ] UI –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É –≤—Å—ñ—Ö –¥–æ—Å—Ç—É–ø–Ω–∏—Ö —Å–∫—ñ–ª—ñ–≤ –≤ –±–∞–∑—É

#### 4.2. –°—Ç–æ—Ä—ñ–Ω–∫–∞ –ê–∫—Ç–∏–≤–Ω–æ–≥–æ –ë–æ—é (`/battles/[battleId]/play`)

- [x] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –≤–µ—Ä—Ö–Ω—é –ø–∞–Ω–µ–ª—å (–Ω–∞–∑–≤–∞, —Ä–∞—É–Ω–¥, –∫–Ω–æ–ø–∫–∞ "–ó–∞–≤–µ—Ä—à–∏—Ç–∏ –•—ñ–¥") (`BattleHeader`)
- [x] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –¥–≤–∞ —Å—Ç–æ–≤–ø—Ü—ñ —É—á–∞—Å–Ω–∏–∫—ñ–≤ (–°–æ—é–∑–Ω–∏–∫–∏ | –í–æ—Ä–æ–≥–∏) - **–∞–¥–∞–ø—Ç–∏–≤–Ω–æ –¥–ª—è –º–æ–±—ñ–ª—å–Ω–∏—Ö**
- [x] –°—Ç–≤–æ—Ä–∏—Ç–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `ParticipantCard` –∑ —É—Å—ñ–º–∞ –ø–æ–ª—è–º–∏ - **–∞–¥–∞–ø—Ç–∏–≤–Ω–æ**
- [x] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Ä—ñ–∑–Ω—É –≤–∏–¥–∏–º—ñ—Å—Ç—å –¥–ª—è –≥—Ä–∞–≤—Ü—ñ–≤ (–±–µ–∑ HP –≤–æ—Ä–æ–≥—ñ–≤) —Ç–∞ DM (–≤—Å—ñ –¥–∞–Ω—ñ)
- [x] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –ø–∞–Ω–µ–ª—å –¥—ñ–π (ActionPanel) –∑ –∫–Ω–æ–ø–∫–∞–º–∏ - **–∞–¥–∞–ø—Ç–∏–≤–Ω–æ, –≤–º—ñ—â—É—î—Ç—å—Å—è –≤ 1-2 –µ–∫—Ä–∞–Ω–∏** (—Å—Ç–≤–æ—Ä–µ–Ω–æ, –ø–æ–∫–∏ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è)
- [x] **–ù–û–í–û:** –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ `BattleFieldView` - —ñ–≥—Ä–æ–≤–µ –ø–æ–ª–µ –∑ —É—Å—ñ–º–∞ —é–Ω—ñ—Ç–∞–º–∏ —Ç–∞ —à–∫–∞–ª–æ—é —Ö–æ–¥—ñ–≤ (–∫–æ–ª–∏ –Ω–µ —Ö—ñ–¥ –≥—Ä–∞–≤—Ü—è)
- [x] **–ù–û–í–û:** –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ `PlayerTurnView` - –µ–∫—Ä–∞–Ω —Ö–æ–¥—É –≥—Ä–∞–≤—Ü—è –∑ –∫–Ω–æ–ø–∫–æ—é "–ü–æ—á–∞—Ç–∏ —Ö—ñ–¥" —Ç–∞ –ø–∞–Ω–µ–ª–ª—é –¥—ñ–π
- [x] **–ù–û–í–û:** –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ `InitiativeTimeline` - —à–∫–∞–ª–∞ —Ö–æ–¥—ñ–≤ –Ω–∞ 3 —Ä–∞—É–Ω–¥–∏ –≤–ø–µ—Ä–µ–¥
- [x] **–ù–û–í–û:** –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ `ActionButtonsPanel` - –ø–∞–Ω–µ–ª—å –¥—ñ–π –∑ –∫–Ω–æ–ø–∫–∞–º–∏ –≤ 3 –∫–æ–ª–æ–Ω–∫–∏
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∑–≥–æ—Ä—Ç–∞—î—Ç—å—Å—è –ª–æ–≥ –±–æ—é
- [ ] –î–æ–¥–∞—Ç–∏ –∞–Ω—ñ–º–∞—Ü—ñ—é —É—Ä–æ–Ω—É –ø–æ —Ü–µ–Ω—Ç—Ä—É –µ–∫—Ä–∞–Ω—É –ø—Ä–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É —à–∫–æ–¥–∏

#### 4.3. –ú–æ–¥–∞–ª—å–Ω—ñ –í—ñ–∫–Ω–∞

- [x] "üéØ –¢–≤—ñ–π —Ö—ñ–¥!" - –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –≥—Ä–∞–≤—Ü—è (—Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –≤ `PlayerTurnView`)
- [x] "üé≤ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ú–æ—Ä–∞–ª—ñ" - –ø–æ–ø–∞–ø –∑ 1d10 (`MoraleCheckDialog`)
- [x] "‚öîÔ∏è –û–±–µ—Ä—ñ—Ç—å –ê—Ç–∞–∫—É" - —Å–ø–∏—Å–æ–∫ –∑–±—Ä–æ—ó (`AttackDialog`)
- [x] "üéØ –í–∏–±—ñ—Ä –¶—ñ–ª—ñ" - —Å–ø–∏—Å–æ–∫ —É—á–∞—Å–Ω–∏–∫—ñ–≤ (–æ–¥–Ω–∞ —Ü—ñ–ª—å –∞–±–æ —á–µ–∫–±–æ–∫—Å–∏ –¥–ª—è AOE) (–≤ `AttackDialog` —Ç–∞ `SpellDialog`)
- [x] "üé≤ Attack Roll" - –ø–æ–ª–µ –¥–ª—è 1d20 + –±–æ–Ω—É—Å–∏ (–≤ `AttackDialog`)
- [x] "üí• Damage Roll" - –ø–æ–ª—è –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∫—É–±–∏–∫–∞ (–≤ `AttackDialog`)
- [x] "‚ú® –ö–Ω–∏–≥–∞ –ó–∞–∫–ª–∏–Ω–∞–Ω—å" - —Å–ø–∏—Å–æ–∫ –∑–∞–∫–ª–∏–Ω–∞–Ω—å –∑ spell slots (`SpellDialog`)
- [x] "üé≤ Saving Throw" - –¥–ª—è –∫–æ–∂–Ω–æ—ó —Ü—ñ–ª—ñ –∑–∞–∫–ª–∏–Ω–∞–Ω–Ω—è (–≤ `SpellDialog`)
- [ ] **–ù–û–í–û:** –û–Ω–æ–≤–∏—Ç–∏ –º–æ–¥–∞–ª—å–Ω—ñ –≤—ñ–∫–Ω–∞ –¥–ª—è –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ–≥–æ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è: –í–∏–±—ñ—Ä –¥—ñ—ó ‚Üí –í–∏–±—ñ—Ä —Ü—ñ–ª—ñ ‚Üí –ö–∏–¥–æ–∫ –ø–æ–ø–∞–¥–∞–Ω–Ω—è ‚Üí –ö–∏–¥–æ–∫ —à–∫–æ–¥–∏
- [ ] **–ù–û–í–û:** –î–æ–¥–∞—Ç–∏ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –≤–∏–±–æ—Ä—É –∑–∞–∫–ª–∏–Ω–∞–Ω–Ω—è/–±–æ–Ω—É—Å–Ω–æ—ó –¥—ñ—ó –ø–µ—Ä–µ–¥ –≤–∏–±–æ—Ä–æ–º —Ü—ñ–ª—ñ

#### 4.4. –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ê–∫—Ç–∏–≤–Ω–∏—Ö –ï—Ñ–µ–∫—Ç—ñ–≤

- [ ] –Ü–∫–æ–Ω–∫–∏ –µ—Ñ–µ–∫—Ç—ñ–≤ –Ω–∞ –∫–∞—Ä—Ç—Ü—ñ —É—á–∞—Å–Ω–∏–∫–∞
- [ ] Tooltip –∑ –Ω–∞–∑–≤–æ—é —Ç–∞ —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—é
- [ ] –ü—ñ–¥—Å–≤—ñ—á—É–≤–∞–Ω–Ω—è –ø–æ–∑–∏—Ç–∏–≤–Ω–∏—Ö (–∑–µ–ª–µ–Ω—ñ) / –Ω–µ–≥–∞—Ç–∏–≤–Ω–∏—Ö (—á–µ—Ä–≤–æ–Ω—ñ) –µ—Ñ–µ–∫—Ç—ñ–≤

---

### –§–ê–ó–ê 5: WebSocket —Ç–∞ –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è

#### 5.1. –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è Real-time –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó

- [ ] –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ Pusher/Ably –¥–ª—è WebSocket
- [ ] –í—ñ–¥–ø—Ä–∞–≤–ª—è—Ç–∏ `battle_started` –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ –±–æ—é
- [ ] –í—ñ–¥–ø—Ä–∞–≤–ª—è—Ç–∏ `battle_updated` –ø—ñ—Å–ª—è –∫–æ–∂–Ω–æ—ó –¥—ñ—ó
- [ ] –í—ñ–¥–ø—Ä–∞–≤–ª—è—Ç–∏ `turn_started` –∫–æ–ª–∏ –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è —Ö—ñ–¥ –≥—Ä–∞–≤—Ü—è
- [ ] –í—ñ–¥–ø—Ä–∞–≤–ª—è—Ç–∏ `notification` –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –≥—Ä–∞–≤—Ü—è
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è UI —á–µ—Ä–µ–∑ WebSocket –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ

#### 5.2. –û–Ω–æ–≤–ª–µ–Ω–Ω—è State —á–µ—Ä–µ–∑ WebSocket

- [ ] –ü—ñ–¥–ø–∏—Å–∞—Ç–∏—Å—å –Ω–∞ –∫–∞–Ω–∞–ª `battle-${battleId}` –≤ React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ
- [ ] –û–Ω–æ–≤–ª—é–≤–∞—Ç–∏ battle state —á–µ—Ä–µ–∑ `useQueryClient.invalidateQueries()`
- [ ] –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏ –≤—Å—ñ—Ö –≥—Ä–∞–≤—Ü—ñ–≤ –ø—Ä–∏ –∫–æ–∂–Ω—ñ–π –∑–º—ñ–Ω—ñ

---

### –§–ê–ó–ê 6: –Ü—Å—Ç–æ—Ä—ñ—è –ë–æ—é —Ç–∞ Rollback

#### 6.1. –î–µ—Ç–∞–ª—å–Ω–∏–π Battle Log

- [ ] –ó–±–µ—Ä—ñ–≥–∞—Ç–∏ –≤—Å—ñ `BattleAction` –≤ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—Å—Ç—ñ
- [ ] –í—ñ–¥–æ–±—Ä–∞–∂–∞—Ç–∏ –ª–æ–≥ –∑ –¥–µ—Ç–∞–ª—å–Ω–∏–º –æ–ø–∏—Å–æ–º –∫–æ–∂–Ω–æ—ó –¥—ñ—ó
- [ ] –î–æ–¥–∞—Ç–∏ –∫–Ω–æ–ø–∫–∏ "–†–µ–¥–∞–≥—É–≤–∞—Ç–∏" —Ç–∞ "–í–∏–¥–∞–ª–∏—Ç–∏" –¥–ª—è DM

#### 6.2. –í—ñ–¥–º—ñ–Ω–∞ –î—ñ–π (Rollback)

- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è BattleAction –∑ –ª–æ–≥—É
- [ ] –í—ñ–¥–∫–æ—Ç–∏—Ç–∏ –≤—Å—ñ –∑–º—ñ–Ω–∏ (HP, –µ—Ñ–µ–∫—Ç–∏, —Å–ª–æ—Ç–∏, summon)
- [ ] –ü–æ–≤–µ—Ä–Ω—É—Ç–∏ `currentTurnIndex` –¥–æ –∞–∫—Ç–æ—Ä–∞
- [ ] WebSocket broadcast –ø—Ä–æ –≤—ñ–¥–º—ñ–Ω—É

---

### –§–ê–ó–ê 7: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ –í–∞–ª—ñ–¥–∞—Ü—ñ—è

#### 7.1. Unit –¢–µ—Å—Ç–∏ –¥–ª—è –ö—Ä–∏—Ç–∏—á–Ω–∏—Ö –ú–µ—Ö–∞–Ω—ñ–∫

- [ ] –¢–µ—Å—Ç–∏ –¥–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É —É—Ä–æ–Ω—É –∑ —É—Å—ñ–º–∞ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∞–º–∏
- [ ] –¢–µ—Å—Ç–∏ –¥–ª—è —ñ–º—É–Ω—ñ—Ç–µ—Ç—ñ–≤ —Ç–∞ –æ–ø–æ—Ä—É
- [ ] –¢–µ—Å—Ç–∏ –¥–ª—è –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–∏—Ö –±–æ–Ω—É—Å—ñ–≤
- [ ] –¢–µ—Å—Ç–∏ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –µ—Ñ–µ–∫—Ç—ñ–≤ (Natural 20/1)
- [ ] –¢–µ—Å—Ç–∏ –¥–ª—è –º–æ—Ä–∞–ª—ñ —Ç–∞ –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö —Ö–æ–¥—ñ–≤
- [ ] –¢–µ—Å—Ç–∏ –¥–ª—è –ø–æ–∫—Ä–∞—â–µ–Ω—å –∑–∞–∫–ª–∏–Ω–∞–Ω–Ω—è

#### 7.2. Integration –¢–µ—Å—Ç–∏ –¥–ª—è –ë–æ—é

- [ ] –¢–µ—Å—Ç —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è BattleScene —Ç–∞ BattleParticipant
- [ ] –¢–µ—Å—Ç —Å—Ç–∞—Ä—Ç—É –±–æ—é —Ç–∞ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É initiative
- [ ] –¢–µ—Å—Ç –ø–æ—á–∞—Ç–∫—É —Ö–æ–¥—É (DOT, –∑–º–µ–Ω—à–µ–Ω–Ω—è —Ç—Ä–∏–≤–∞–ª–æ—Å—Ç—ñ)
- [ ] –¢–µ—Å—Ç –∞—Ç–∞–∫–∏ –∑ —É—Å—ñ–º–∞ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∞–º–∏
- [ ] –¢–µ—Å—Ç –∑–∞–∫–ª–∏–Ω–∞–Ω–Ω—è –∑ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è–º–∏
- [ ] –¢–µ—Å—Ç –∫–æ–Ω—Ç—Ä-—É–¥–∞—Ä—É (Reaction)
- [ ] –¢–µ—Å—Ç –ø—Ä–∏–∑–∏–≤–∞–Ω–Ω—è
- [ ] –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –±–æ—é —Ç–∞ –ø–µ—Ä–µ–º–æ–≥–∏

#### 7.3. E2E –¢–µ—Å—Ç–∏ –¥–ª—è UI

- [ ] –¢–µ—Å—Ç –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∏ –±–æ—é (–≤–∏–±—ñ—Ä —É—á–∞—Å–Ω–∏–∫—ñ–≤)
- [ ] –¢–µ—Å—Ç —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –±–æ—é (–∫–∞—Ä—Ç–∫–∏ —É—á–∞—Å–Ω–∏–∫—ñ–≤)
- [ ] –¢–µ—Å—Ç –º–æ–¥–∞–ª—å–Ω–∏—Ö –≤—ñ–∫–æ–Ω (–∞—Ç–∞–∫–∞, –∑–∞–∫–ª–∏–Ω–∞–Ω–Ω—è)
- [ ] –¢–µ—Å—Ç –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —É—Ä–æ–Ω—É (–∞–Ω—ñ–º–∞—Ü—ñ—è)
- [ ] –¢–µ—Å—Ç –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—ñ –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—è—Ö

#### 7.4. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó

- [ ] –¢–µ—Å—Ç WebSocket –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ (–∫—ñ–ª—å–∫–∞ –≥—Ä–∞–≤—Ü—ñ–≤)
- [ ] –ü–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—å —â–æ –≤—Å—ñ –≥—Ä–∞–≤—Ü—ñ –±–∞—á–∞—Ç—å –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –æ–¥–Ω–æ—á–∞—Å–Ω–æ
- [ ] –ü–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—å —â–æ HP –≤–æ—Ä–æ–≥—ñ–≤ –ø—Ä–∏—Ö–æ–≤–∞–Ω—ñ –¥–ª—è –≥—Ä–∞–≤—Ü—ñ–≤
- [ ] –¢–µ—Å—Ç –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—ñ—Å–ª—è –≤—Ç—Ä–∞—Ç–∏ –∑–≤'—è–∑–∫—É

#### 7.5. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è Edge Cases

- [ ] –©–æ —è–∫—â–æ –≤—Å—ñ —É—á–∞—Å–Ω–∏–∫–∏ –≤ `unconscious`?
- [ ] –©–æ —è–∫—â–æ –µ—Ñ–µ–∫—Ç –∑–∞–∫—ñ–Ω—á–∏–≤—Å—è –≤ —Å–µ—Ä–µ–¥–∏–Ω—ñ —Ö–æ–¥—É?
- [ ] –©–æ —è–∫—â–æ –∫—Ä–∏—Ç–∏—á–Ω–∏–π –µ—Ñ–µ–∫—Ç –∑–º—ñ–Ω—é—î initiative?
- [ ] –©–æ —è–∫—â–æ –ø—Ä–∏–∑–∏–≤ –∑'—è–≤–ª—è—î—Ç—å—Å—è –≤ —Å–µ—Ä–µ–¥–∏–Ω—ñ —Ä–∞—É–Ω–¥—É?
- [ ] –©–æ —è–∫—â–æ –º–æ—Ä–∞–ª—å –∑–º—ñ–Ω—é—î—Ç—å—Å—è –ø—ñ–¥ —á–∞—Å –±–æ—é?
- [ ] –¢–µ—Å—Ç –∑ –≤–µ–ª–∏–∫–æ—é –∫—ñ–ª—å–∫—ñ—Å—Ç—é —É—á–∞—Å–Ω–∏–∫—ñ–≤ (–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å)

---

## üéØ –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–∏ –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó

### üî¥ –í–ò–°–û–ö–ò–ô –ü–†–Ü–û–†–ò–¢–ï–¢ (–ö—Ä–∏—Ç–∏—á–Ω–µ –¥–ª—è –±–∞–∑–æ–≤–æ–≥–æ –±–æ—é):

1. ‚úÖ BattleParticipant - –ø–æ–≤–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–§–∞–∑–∞ 1.1) - **–ß–ê–°–¢–ö–û–í–û** (–±–∞–∑–æ–≤—ñ –ø–æ–ª—è —î)
2. ‚úÖ –°—Ç–∞—Ä—Ç –±–æ—é - —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è BattleParticipant (–§–∞–∑–∞ 3.1) - **–ß–ê–°–¢–ö–û–í–û** (–±–∞–∑–æ–≤–∞ –ª–æ–≥—ñ–∫–∞ —î)
3. ‚ö†Ô∏è –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ Initiative (–§–∞–∑–∞ 3.2) - **–ß–ê–°–¢–ö–û–í–û** (–±–∞–∑–æ–≤–∞ –ª–æ–≥—ñ–∫–∞ —î)
4. ‚ö†Ô∏è –ê—Ç–∞–∫–∞ - —Ä–æ–∑—à–∏—Ä–µ–Ω–∞ –ª–æ–≥—ñ–∫–∞ (–§–∞–∑–∞ 3.5) - **–ß–ê–°–¢–ö–û–í–û** (–±–∞–∑–æ–≤–∞ –ª–æ–≥—ñ–∫–∞ —î)
5. ‚¨ú –ë–∞–∑–æ–≤–∏–π UI –±–æ—é (–§–∞–∑–∞ 4.2) - **–ù–ï –ü–û–ß–ê–¢–û**

### üü° –°–ï–†–ï–î–ù–Ü–ô –ü–†–Ü–û–†–ò–¢–ï–¢:

6. ‚¨ú –ü–æ—á–∞—Ç–æ–∫ —Ö–æ–¥—É (DOT, –µ—Ñ–µ–∫—Ç–∏) (–§–∞–∑–∞ 3.3)
7. ‚¨ú –ó–∞–∫–ª–∏–Ω–∞–Ω–Ω—è - —Ä–æ–∑—à–∏—Ä–µ–Ω–∞ –ª–æ–≥—ñ–∫–∞ (–§–∞–∑–∞ 3.6)
8. ‚¨ú –ú–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ —É—Ä–æ–Ω—É –∑—ñ —Å–∫—ñ–ª—ñ–≤ (–§–∞–∑–∞ 2.1)
9. ‚¨ú –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è –∑–∞–∫–ª–∏–Ω–∞–Ω–Ω—è (–§–∞–∑–∞ 2.2)
10. ‚¨ú –ú–æ—Ä–∞–ª—å (–§–∞–∑–∞ 1.6, 3.4) - **–ß–ê–°–¢–ö–û–í–û** (–ø–æ–ª–µ –¥–æ–¥–∞–Ω–æ)

### üü¢ –ù–ò–ó–¨–ö–ò–ô –ü–†–Ü–û–†–ò–¢–ï–¢:

11. ‚¨ú –ü–∞—Å–∏–≤–Ω—ñ –∑–¥—ñ–±–Ω–æ—Å—Ç—ñ –∑ —Ç—Ä–∏–≥–µ—Ä–∞–º–∏ (–§–∞–∑–∞ 1.5)
12. ‚¨ú –ö—Ä–∏—Ç–∏—á–Ω—ñ –µ—Ñ–µ–∫—Ç–∏ (–§–∞–∑–∞ 1.3) - **–ß–ê–°–¢–ö–û–í–û** (–∫–æ–Ω—Å—Ç–∞–Ω—Ç–∏ —Å—Ç–≤–æ—Ä–µ–Ω—ñ)
13. ‚¨ú –ü—Ä–∏–∑–∏–≤–∞–Ω–Ω—è (–§–∞–∑–∞ 3.9)
14. ‚¨ú –ö–æ–Ω—Ç—Ä-—É–¥–∞—Ä (–≤–∂–µ —á–∞—Å—Ç–∫–æ–≤–æ –≤ –§–∞–∑—ñ 3.5)
15. ‚¨ú Rollback (–§–∞–∑–∞ 6.2)

---

## üìù –ü—Ä–∏–º—ñ—Ç–∫–∏

- **–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è:** –í—Å—ñ —Å—Ü–µ–Ω–∏ –±–æ—é –ø–æ–∫—Ä–∏—Ç—ñ unit, integration —Ç–∞ E2E —Ç–µ—Å—Ç–∞–º–∏
- **–ê–¥–∞–ø—Ç–∏–≤–Ω—ñ—Å—Ç—å:** –í–µ—Å—å UI –º–∞—î –±—É—Ç–∏ –∞–¥–∞–ø—Ç–∏–≤–Ω–∏–º, –æ—Å–æ–±–ª–∏–≤–æ –¥–ª—è –º–æ–±—ñ–ª—å–Ω–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤
- **–ê–Ω—ñ–º–∞—Ü—ñ—ó:** –ê–Ω—ñ–º–∞—Ü—ñ—è —É—Ä–æ–Ω—É –ø–æ —Ü–µ–Ω—Ç—Ä—É –µ–∫—Ä–∞–Ω—É –ø—Ä–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É —à–∫–æ–¥–∏
- **–Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å:** –í—Å–µ –º–∞—î –≤–º—ñ—â—É–≤–∞—Ç–∏—Å—è –≤ 1-2 –µ–∫—Ä–∞–Ω–∏, —ñ–Ω—Ç—É—ó—Ç–∏–≤–Ω–æ –∑—Ä–æ–∑—É–º—ñ–ª–æ

---

## üîÑ –•—Ä–æ–Ω—ñ–∫–∞ –ó–º—ñ–Ω

### 2026-01-23

- ‚úÖ –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –Ω–æ–≤–∏–π UI –¥–ª—è –±–∏—Ç–≤–∏ –∑ –¥–≤–æ–º–∞ —Ä–µ–∂–∏–º–∞–º–∏ (BattleFieldView —Ç–∞ PlayerTurnView)
- ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –¥–ª—è –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ–≥–æ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª—å–Ω–∏—Ö –≤—ñ–∫–æ–Ω (AttackTypeDialog, TargetSelectionDialog, AttackRollDialog, DamageRollDialog, SpellSelectionDialog)
- ‚úÖ –î–æ–¥–∞–Ω–æ –ø–æ–ª–µ `skillTriggers` –≤ `ActiveSkill` –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Ç—Ä–∏–≥–µ—Ä—ñ–≤ —Å–∫—ñ–ª—ñ–≤
- ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ —É—Ç–∏–ª—ñ—Ç–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ç—Ä–∏–≥–µ—Ä—ñ–≤ —Å–∫—ñ–ª—ñ–≤ (`skill-triggers-execution.ts`)
- ‚úÖ –Ü–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ç—Ä–∏–≥–µ—Ä—ñ–≤ –≤ `processStartOfRound`, `processAttack`, `processSpell`
- ‚úÖ –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –±–æ–Ω—É—Å–Ω–∏—Ö –¥—ñ–π –∑ —Ç—Ä–∏–≥–µ—Ä—ñ–≤ –≤ –ø–∞–Ω–µ–ª—ñ –¥—ñ–π –≥—Ä–∞–≤—Ü—è
- ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `InitiativeTimeline` –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —à–∫–∞–ª–∏ —Ö–æ–¥—ñ–≤ –Ω–∞ 3 —Ä–∞—É–Ω–¥–∏

### 2026-01-18

- ‚úÖ –î–æ–¥–∞–Ω–æ –ø–æ–ª–µ `morale` –≤ Character —Ç–∞ Unit —Å—Ö–µ–º–∞—Ö
- ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∏ –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –µ—Ñ–µ–∫—Ç—ñ–≤
- ‚úÖ –û–Ω–æ–≤–ª–µ–Ω–æ —Ç–∏–ø–∏ BattleParticipant –∑ morale
- ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ –ø–æ–≤–Ω—É –º–æ–¥–µ–ª—å `BattleParticipant` –≤ TypeScript –∑ —É—Å—ñ–º–∞ –ø–æ–ª—è–º–∏ (–∞–∫—Ç–∏–≤–Ω—ñ –µ—Ñ–µ–∫—Ç–∏, –ø–∞—Å–∏–≤–∫–∏, —Å–∫—ñ–ª–∏, –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∏, —Ñ–ª–∞–≥–∏ –¥—ñ–π)
- ‚úÖ –í–∏–¥–∞–ª–µ–Ω–æ `InitiativeParticipant` (–∑–∞–º—ñ–Ω–∞ –Ω–∞ `BattleParticipant` —É –≤—Å—ñ—Ö —Ñ–∞–π–ª–∞—Ö)
- ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ —É—Ç–∏–ª—ñ—Ç–∏ `createBattleParticipantFromCharacter` —Ç–∞ `createBattleParticipantFromUnit` –≤ `/lib/utils/battle-participant.ts`
- ‚úÖ –Ü–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–æ —É—Ç–∏–ª—ñ—Ç–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó –≤ `/start/route.ts` - –±–∞–∑–æ–≤–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∞—Ü—é—î
- ‚úÖ –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –ø–æ–≤–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–µ—Ç–∞–ª–µ–π —Å–∫—ñ–ª—ñ–≤ –∑ –ë–î (name, effects –∑ bonuses, spellEnhancements)
- ‚úÖ –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –ø–æ–≤–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ñ–≤ –∑ –ë–î (bonuses, modifiers, passiveAbility)
- ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å `BattleAction` –∑ —É—Å—ñ–º–∞ –ø–æ–ª—è–º–∏ (`actionDetails`, `hpChanges`, `isCancelled`)
- ‚úÖ –†–æ–∑—à–∏—Ä–µ–Ω–æ `battleLog` –≤ `BattleScene` –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è `BattleAction[]`
- ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ —É—Ç–∏–ª—ñ—Ç–∏ –¥–ª—è DOT –µ—Ñ–µ–∫—Ç—ñ–≤ (`lib/utils/battle-effects.ts`): `applyDOTEffects`, `decreaseEffectDurations`, `addActiveEffect`
- ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ –±–∞–∑–æ–≤—É —Å–∏—Å—Ç–µ–º—É —Ç—Ä–∏–≥–µ—Ä—ñ–≤ (`lib/utils/battle-triggers.ts`): `checkTriggerCondition`, `getPassiveAbilitiesByTrigger`, `evaluateCondition`
- ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ —É—Ç–∏–ª—ñ—Ç–∏ –¥–ª—è –º–æ—Ä–∞–ª—ñ (`lib/utils/battle-morale.ts`): `checkMorale`, `validateD10Roll`, `getMoraleCheckDescription`
- ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ —É—Ç–∏–ª—ñ—Ç–∏ –¥–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É —É—Ä–æ–Ω—É (`lib/utils/battle-damage-calculations.ts`): `calculateDamageWithModifiers`, –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ñ —Ç–∞ flat –±–æ–Ω—É—Å–∏ –∑—ñ —Å–∫—ñ–ª—ñ–≤, –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ñ–≤, –ø–∞—Å–∏–≤–æ–∫
- ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ —É—Ç–∏–ª—ñ—Ç–∏ –¥–ª—è –ø–æ–∫—Ä–∞—â–µ–Ω—å –∑–∞–∫–ª–∏–Ω–∞–Ω–Ω—è (`lib/utils/battle-spell-calculations.ts`): `calculateSpellDamageWithEnhancements`, `spellEffectIncrease`, `spellAdditionalModifier`, `spellTargetChange`
- ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ —É—Ç–∏–ª—ñ—Ç–∏ –¥–ª—è —ñ–º—É–Ω—ñ—Ç–µ—Ç—ñ–≤/–æ–ø–æ—Ä—É (`lib/utils/battle-resistance.ts`): `applyResistance`, `hasImmunity`, `getResistance`
- ‚úÖ –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä–∞—Å–æ–≤–∏—Ö –∑–¥—ñ–±–Ω–æ—Å—Ç–µ–π –≤ `BattleParticipant` (`extractRacialAbilities`)
